<!DOCTYPE html><html><head><meta charset="utf-8"><title>Moyufed</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="分享有趣好玩前端技术"><meta name="keywords" content="前端,分享,nodejs"><meta property="og:type" content="website"><meta property="og:title" content="Moyufed"><meta property="og:url" content="http://blog.moyufed.com/index.html"><meta property="og:site_name" content="Moyufed"><meta property="og:description" content="分享有趣好玩前端技术"><meta property="og:locale" content="zh-CN"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Moyufed"><meta name="twitter:description" content="分享有趣好玩前端技术"><link rel="alternate" href="/atom.xml" title="Moyufed" type="application/atom+xml"><link rel="icon" href="/favicon.png"><link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css"><link rel="stylesheet" href="/css/style.css"></head></html><body><div id="container"><div id="wrap"><header id="header"><div id="banner"></div><div id="header-outer" class="outer"><div id="header-title" class="inner"><h1 id="logo-wrap"><a href="/" id="logo">Moyufed</a></h1><h2 id="subtitle-wrap"><a href="/" id="subtitle">又摸到好大一条鱼，羡慕~！摸鱼前端分享交流，欢迎一起来摸鱼。</a></h2></div><div id="header-inner" class="inner"><nav id="main-nav"><a id="main-nav-toggle" class="nav-icon"></a> <a class="main-nav-link" href="/">Home</a> <a class="main-nav-link" href="/archives">Archives</a></nav><nav id="sub-nav"><a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a> <a id="nav-search-btn" class="nav-icon" title="搜索"></a></nav><div id="search-form-wrap"><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.moyufed.com"></form></div></div></div></header><div class="outer"><section id="main"><article id="post-【前端开发日常-18】快速配置webpack开发环境" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2020/04/04/【前端开发日常-18】快速配置webpack开发环境/" class="article-date"><time datetime="2020-04-04T02:22:36.000Z" itemprop="datePublished">2020-04-03</time></a></div><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2020/04/04/【前端开发日常-18】快速配置webpack开发环境/">【前端开发日常 - 18】快速配置webpack开发环境</a></h1></header><div class="article-entry" itemprop="articleBody"><h2 id="检查环境"><a href="#检查环境" class="headerlink" title="检查环境"></a>检查环境</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> node -v</span></span><br><span class="line">v8.10.0</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm -v</span></span><br><span class="line">5.6.0</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> yarn -v</span></span><br><span class="line">1.13.0</span><br></pre></td></tr></table></figure><h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> mkdir webpack-start</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> webpack-start</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm init</span></span><br></pre></td></tr></table></figure><p>根据提示输入项目信息，比如：<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Press ^C at any time to quit.</span><br><span class="line">package name: (webpack-start)</span><br><span class="line">version: (1.0.0)</span><br><span class="line">description: 快速开始webpack开发</span><br><span class="line">entry point: (index.js) src/index.js</span><br><span class="line">test command:</span><br><span class="line">git repository:</span><br><span class="line">keywords: webpack</span><br><span class="line">author: moyufed</span><br><span class="line">license: (ISC)</span><br><span class="line">About to write to F:\project\webpack-start\package.json:</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "name": "webpack-start",</span><br><span class="line">  "version": "1.0.0",</span><br><span class="line">  "description": "快速开始webpack开发",</span><br><span class="line">  "main": "src/index.js",</span><br><span class="line">  "scripts": &#123;</span><br><span class="line">    "test": "echo \"Error: no test specified\" &amp;amp;&amp;amp; exit 1"</span><br><span class="line">  &#125;,</span><br><span class="line">  "keywords": [</span><br><span class="line">    "webpack"</span><br><span class="line">  ],</span><br><span class="line">  "author": "moyufed",</span><br><span class="line">  "license": "ISC"</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Is this ok? (yes)</span><br></pre></td></tr></table></figure><p></p><h2 id="安装-webpack-和-webpack-cli"><a href="#安装-webpack-和-webpack-cli" class="headerlink" title="安装 webpack 和 webpack-cli"></a>安装 webpack 和 webpack-cli</h2><p>现在都已经 0202 年，webpack已经是到了4的版本了，不再与webpack-cli放在同一个仓库，因此安装完 webpack 之后还需要安装 webpack-cli 搭配食用才会香。参考文章：<a href="https://stackoverflow.com/questions/49092291/the-cli-moved-into-a-separate-package-webpack-cli" target="_blank" rel="noopener">https://stackoverflow.com/questions/49092291/the-cli-moved-into-a-separate-package-webpack-cli</a><br>那么来看看安装命令：<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 使用npm</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm install --save-dev webpack webpack-cli</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用yarn</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yarn add -D  webpack webpack-cli</span></span><br></pre></td></tr></table></figure><p></p><p>这命令里面的 –save-dev 和 -D 都表示将包安装到开发环境， -D 是 –dev 的简写。<br>执行安装之后，可以看到package.json文件里面多了两个依赖，是我们的开发环境需要使用的：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line">  <span class="string">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="string">"webpack"</span>: <span class="string">"^4.42.0"</span>,</span><br><span class="line">    <span class="string">"webpack-cli"</span>: <span class="string">"^3.3.11"</span></span><br><span class="line">  &#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p></p><h2 id="配置webpack"><a href="#配置webpack" class="headerlink" title="配置webpack"></a>配置webpack</h2><p>在项目的根目录下创建一个 webpack.config.js 文件，当我们使用 webpack 时会自动查找这个文件里面的配置信息。<br>创建好配置文件之后，就需要编写一个简单的配置，让webpack可以正常工作：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">        filename: <span class="string">'bundle.js'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>上面的配置代码指定了入口文件，也指定了打包输出的文件目录和文件名，接下来就是去建立入口文件&nbsp;src/index.js ，然后在里面写自己的 JavaScript 代码 。</p><h2 id="启动项目"><a href="#启动项目" class="headerlink" title="启动项目"></a>启动项目</h2><p>在package.json中，找到script这一项，增加webpack的执行命令：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"build"</span>: <span class="string">"webpack"</span></span><br><span class="line">  &#125;,</span><br><span class="line"><span class="comment">//</span></span><br></pre></td></tr></table></figure><p></p><p>添加好了之后，我们可以在命令行执行命令：<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> npm</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm run build</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> yarn</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yarn build</span></span><br></pre></td></tr></table></figure><p></p><p>执行完成之后，就可以看到项目产生了一个 dist 目录，里面生成了 bundle.js 文件，里面包含了我写的 JavaScript 代码。</p><h2 id="配置开发服务器"><a href="#配置开发服务器" class="headerlink" title="配置开发服务器"></a>配置开发服务器</h2><p>要配置开发服务器（devServer），我们需要安装&nbsp;<a href="https://github.com/webpack/webpack-dev-server" target="_blank" rel="noopener">webpack-dev-server</a>&nbsp;，具体可以参考文档&nbsp;<a href="https://webpack.docschina.org/configuration/dev-server/" target="_blank" rel="noopener">https://webpack.docschina.org/configuration/dev-server/</a>&nbsp;，<br>首先来安装：<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> npm</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm install --save-dev webpack-dev-server</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> yarn</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yarn add -D webpack-dev-server</span></span><br></pre></td></tr></table></figure><p></p><p>执行安装之后，需要来配置服务器，可以在webpack的配置文件里面增加 devServer 配置：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">        filename: <span class="string">'bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    devServer: &#123;</span><br><span class="line">        port: <span class="number">8080</span>,</span><br><span class="line">        hot: <span class="literal">true</span>,</span><br><span class="line">        open: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>上面配置了开发服务器启动的端口，hot 用来设置开启热模块替换， open 来设置编译之后打开浏览器预览。现在我们进行了简单的devServer配置，还需要增加启动的命令：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line">  <span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"start"</span>: <span class="string">"webpack-dev-server"</span>,</span><br><span class="line">    <span class="string">"build"</span>: <span class="string">"webpack"</span></span><br><span class="line">  &#125;,</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p></p><p>通过执行 start 命令可以启动开发服务器。</p><h2 id="增加HTML模板"><a href="#增加HTML模板" class="headerlink" title="增加HTML模板"></a>增加HTML模板</h2><p>需要使用到 html-webpack-plugin 来使用生成HTML，&nbsp;<a href="https://webpack.docschina.org/plugins/html-webpack-plugin/" target="_blank" rel="noopener">https://webpack.docschina.org/plugins/html-webpack-plugin/</a>&nbsp;，执行命令安装：<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> npm</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm install --save-dev html-webpack-plugin</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> yarn</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yarn add -D html-webpack-plugin</span></span><br></pre></td></tr></table></figure><p></p><p>安装好之后，我们就需要去使用插件了，在webpack.config.js中，引入这个插件，然后在plugin里面使用：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">        filename: <span class="string">'bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    devServer: &#123;</span><br><span class="line">        port: <span class="number">8080</span>,</span><br><span class="line">        hot: <span class="literal">true</span>,</span><br><span class="line">        open: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [<span class="keyword">new</span> HtmlWebpackPlugin()]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>使用了插件之后，我们可以再次启动开发服务器，这时候插件就自动会生成HTML了，并且还会自动引入我们的bundle.js，如果我们需要自定义HTML的模板，还可以对插件进行配置，配置的文档：&nbsp;<a href="https://github.com/jantimon/html-webpack-plugin#options" target="_blank" rel="noopener">https://github.com/jantimon/html-webpack-plugin#options</a>&nbsp;，下面我们对HTML进行简单配置：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line">    plugins: [<span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">        title: <span class="string">'webpack-start'</span>,</span><br><span class="line">        template: <span class="string">'index.html'</span>,</span><br><span class="line">    &#125;)]</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p></p><p>相应的，我们需要在项目根目录新建一个 index.html 文件，使用 html-webpack-plugin 的配置：<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"utf-8"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">htmlWebpackPlugin.options.title</span> %&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>上面的代码中使用了 webpack 配置里面的 title ，更多配置可以参考：&nbsp;<a href="https://github.com/jantimon/html-webpack-plugin#configuration" target="_blank" rel="noopener">https://github.com/jantimon/html-webpack-plugin#configuration</a>&nbsp;。</p><h2 id="安装babel"><a href="#安装babel" class="headerlink" title="安装babel"></a>安装babel</h2><p>这里使用 babel7，需要注意的是，我们要安装 webpack 的 babel-loader 才能使用 babel，但是 babel-loader 的版本是和 babel 不一样的，比如 babel7 要使用的 babel-loader 是8.x版本，如果安装相同的版本，编译时会报错。<br>因此在执行安装之后，注意检查 package.json 里面的 babel-loader 是什么版本。<br>具体参考：&nbsp;<a href="https://www.webpackjs.com/loaders/babel-loader/" target="_blank" rel="noopener">https://www.webpackjs.com/loaders/babel-loader/</a>&nbsp;。<br>安装babel-loader：<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> npm</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm install --save-dev babel-loader</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> yarn</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yarn add -D babel-loader</span></span><br></pre></td></tr></table></figure><p></p><p>检查安装的 babel-loader 的版本，安装下来是 8.x 的版本，对应的 babel-core 版本是 7 ：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"devDependencies"</span>: &#123;</span><br><span class="line">  <span class="string">"babel-loader"</span>: <span class="string">"^8.0.6"</span>,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>安装babel：<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> npm</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm install --save-dev @babel/core</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> yarn</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yarn add -D @babel/core</span></span><br></pre></td></tr></table></figure><p></p><p>安装 @babel/preset-env，这将使得我们的项目支持 JavaScript 的ES6特性：<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> npm</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm install --save-dev @babel/preset-env</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> yarn</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yarn add -D @babel/preset-env</span></span><br></pre></td></tr></table></figure><p></p><h2 id="配置babel"><a href="#配置babel" class="headerlink" title="配置babel"></a>配置babel</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">      exclude: <span class="regexp">/(node_modules|bower_components)/</span>,</span><br><span class="line">      use: &#123;</span><br><span class="line">        loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          presets: [<span class="string">'@babel/preset-env'</span>]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面的配置中，我们对 JavaScript 文件使用了 babel ，并且过滤了我们的依赖安装目录，而在&nbsp;presets 中我们使用了@babel/preset-env ， 这会根据我们的编译目标浏览器来使用对应的兼容，从而将ES6代码转换成ES5。<br>我们来检测一下有没有生效，首先在我们的index.js代码里面打入一个断点：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    init() &#123;</span><br><span class="line">        <span class="keyword">debugger</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">123</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Demo();</span><br></pre></td></tr></table></figure><p></p><p>然后我们在浏览器进入断点查看，开始babel配置之前的代码，发现我们的代码没有进行转换，而我们的浏览器能够正常打印log主要是因为该浏览器已经支持ES6的语法：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    init() &#123;</span><br><span class="line">        <span class="keyword">debugger</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">123</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Demo();</span><br></pre></td></tr></table></figure><p></p><p>开启babel之后的代码，我们发现已经经过了转化，成为了ES5的代码：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Demo = <span class="comment">/*#__PURE__*/</span><span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">Demo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    _classCallCheck(<span class="keyword">this</span>, Demo);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.init();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  _createClass(Demo, [&#123;</span><br><span class="line">    key: <span class="string">"init"</span>,</span><br><span class="line">    value: <span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">debugger</span>;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="number">123</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> Demo;</span><br><span class="line">&#125;();</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Demo();</span><br></pre></td></tr></table></figure><p></p><p>关于 @babel/preset-env&nbsp;可以参考：&nbsp;<a href="https://www.babeljs.cn/docs/babel-preset-env" target="_blank" rel="noopener">https://www.babeljs.cn/docs/babel-preset-env</a>&nbsp;。</p><h2 id="使用类属性"><a href="#使用类属性" class="headerlink" title="使用类属性"></a>使用类属性</h2><p>我们接着来修改 index.js 代码，这次我们来使用类的属性，如下：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    text = <span class="string">'123'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    init() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.text);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Demo();</span><br></pre></td></tr></table></figure><p></p><p>我们发现，这是 webpack 编译报错了：<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ERROR in ./src/index.js</span><br><span class="line">Module build failed (from ./node_modules/babel-loader/lib/index.js):</span><br><span class="line">SyntaxError: G:\webpack-start\src\index.js: Support for the experimental syntax 'classProperties' isn't currently enabled (3:10):</span><br></pre></td></tr></table></figure><p></p><p>因此我们需要解决现在的配置不能使用 classProperties 的问题。为了解决这个问题我们需要安装一个插件，在babel7里面，我们使用的是 @babel/plugin-proposal-class-properties 。<br>注意：在 babel7 里面我们的插件基本上都是在 @babel 这个空间下面。<br>先来安装插件:<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> npm</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm install --save-dev @babel/plugin-proposal-class-properties</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> yarn</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yarn add -D @babel/plugin-proposal-class-properties</span></span><br></pre></td></tr></table></figure><p></p><p>然后在我们的配置里面使用插件：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                exclude: <span class="regexp">/(node_modules|bower_components)/</span>,</span><br><span class="line">                use: &#123;</span><br><span class="line">                    loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">                    options: &#123;</span><br><span class="line">                        presets: [</span><br><span class="line">                            <span class="string">'@babel/preset-env'</span></span><br><span class="line">                        ],</span><br><span class="line">                        plugins: [</span><br><span class="line">                            <span class="string">'@babel/plugin-proposal-class-properties'</span></span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p></p><p>接着我们来启动编译，代码正常运行。<br>关于@babel/plugin-proposal-class-properties具体可以参考文档：&nbsp;<a href="https://babeljs.io/docs/en/babel-plugin-proposal-class-properties" target="_blank" rel="noopener">https://babeljs.io/docs/en/babel-plugin-proposal-class-properties</a></p><h2 id="使用async-await"><a href="#使用async-await" class="headerlink" title="使用async/await"></a>使用async/await</h2><p>我们接着来修改index.js里面的代码，这次要在代码里面async/await：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    text = <span class="string">'123'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> init() &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">await</span> <span class="keyword">this</span>.wait();</span><br><span class="line">        &#125; <span class="keyword">catch</span>(error) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(error);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.text);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    wait() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>((resolve, reject) =&amp;gt; &#123;</span><br><span class="line">            setTimeout(() =&amp;gt; &#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="built_in">Math</span>.random() &amp;gt; <span class="number">0.5</span>) &#123;</span><br><span class="line">                    resolve()</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'&amp;lt;=0.5'</span>))</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="number">1000</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Demo();</span><br></pre></td></tr></table></figure><p></p><p>保存，编译之后，我们发现浏览器报出错误：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Uncaught <span class="built_in">ReferenceError</span>: regeneratorRuntime is not defined</span><br></pre></td></tr></table></figure><p></p><p>为了解决这个问题，我们需要安装&nbsp;@babel/plugin-transform-runtime：<br></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> npm</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> npm install --save-dev @babel/plugin-transform-runtime</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> yarn</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> yarn add -D @babel/plugin-transform-runtime</span></span><br></pre></td></tr></table></figure><p></p><p>继续，我们去修改配置，添加这个babel插件：<br></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// ...   </span></span><br><span class="line">		<span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                exclude: <span class="regexp">/(node_modules|bower_components)/</span>,</span><br><span class="line">                use: &#123;</span><br><span class="line">                    loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">                    options: &#123;</span><br><span class="line">                        presets: [</span><br><span class="line">                            <span class="string">'@babel/preset-env'</span></span><br><span class="line">                        ],</span><br><span class="line">                        plugins: [</span><br><span class="line">                            <span class="string">'@babel/plugin-proposal-class-properties'</span>,</span><br><span class="line">                            <span class="string">'@babel/plugin-transform-runtime'</span></span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p></p><p>重新编译，我们发现代码已经能够正常运行。<br>关于 @babel/plugin-transform-runtime 具体可以参考文档：<a href="https://babeljs.io/docs/en/babel-plugin-transform-runtime" target="_blank" rel="noopener">https://babeljs.io/docs/en/babel-plugin-transform-runtime</a>&nbsp;。</p><h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><p>本次只介绍从安装 webpack 到配置 babel ，从而满足我们的开发所需，关于 webpack 和 babel 的配置还有很多内容，这将会在以后继续补充进来。</p></div><footer class="article-footer"><a data-url="http://blog.moyufed.com/2020/04/04/【前端开发日常-18】快速配置webpack开发环境/" data-id="ck8k1iwlo000kz4vynk0dp8ey" class="article-share-link">Share</a></footer></div></article><article id="post-JavaScript的this关键字" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2020/03/31/JavaScript的this关键字/" class="article-date"><time datetime="2020-03-31T06:15:14.000Z" itemprop="datePublished">2020-03-30</time></a></div><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2020/03/31/JavaScript的this关键字/">JavaScript的this关键字</a></h1></header><div class="article-entry" itemprop="articleBody"><h2 id="JavaScript的this关键字"><a href="#JavaScript的this关键字" class="headerlink" title="JavaScript的this关键字"></a>JavaScript的this关键字</h2><p><code>this</code> 关键字指向一个对象，该对象是JavaScript当前代码执行的小块。换而言之，每个JavaScript方法执行的时候都有一个执行上下文（execution context），就是我们的 this。执行上下文体现了当前方法是如何被调用的。</p><p>为了理解 <code>this</code> 关键字，我们首先要关注方法是何时、何处、以何种方式调用的，而不是关注方法在何处以何种方式声明。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bike</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">"Ninja"</span>;</span><br><span class="line"><span class="keyword">var</span> obj1 = &#123; <span class="attr">name</span>: <span class="string">"Pulsar"</span>, <span class="attr">bike</span>: bike &#125;;</span><br><span class="line"><span class="keyword">var</span> obj2 = &#123; <span class="attr">name</span>: <span class="string">"Gixxer"</span>, <span class="attr">bike</span>: bike &#125;;</span><br><span class="line"></span><br><span class="line">bike();           <span class="comment">// "Ninja"</span></span><br><span class="line">obj1.bike();      <span class="comment">// "Pulsar"</span></span><br><span class="line">obj2.bike();      <span class="comment">// "Gixxer"</span></span><br></pre></td></tr></table></figure><p>在上面的代码中， <code>bike()</code> 方法的作用就是打印 <code>this.name</code> ，也就是说打印出当前执行上下文的 <code>name</code> 属性的值。当 <code>bike()</code> 方法被调用时，打印出 “Ninja” ，因为在没有指定的情况下，执行上下文都会指向<strong>全局对象</strong>，而在全局对象上面，我们定义了一个 <code>name</code> 的属性，值是 “Ninja”。</p><p>同样的，在 <code>obj1().bike()</code> 中打印了 “Pulsar” ，因为 <code>bike()</code> 方法是以 <code>obj1</code> 作为执行上下文来调用的， <code>this.name</code> 实际上就是 <code>obj1.name</code> 。同理 <code>obj2.bike()</code> 方法的执行上下文就是 <code>obj2</code> 。</p><h2 id="This的默认绑定和隐式绑定"><a href="#This的默认绑定和隐式绑定" class="headerlink" title="This的默认绑定和隐式绑定"></a>This的默认绑定和隐式绑定</h2><p><strong>默认绑定：</strong>如果我们的代码是在严格模式（strict mode）下， <code>this</code> 的值就是 <code>undefined</code> ，否则， <code>this</code> 指代了<strong>全局对象</strong> 。</p><p>当单独使用时，它指的是<strong>全局对象</strong> ，浏览器中的<strong>全局对象</strong>其实就是 window 对象 [<strong>object Window</strong>] ，示例：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="keyword">this</span>;</span><br></pre></td></tr></table></figure><p>当在一个方法中使用，this指向全局对象，示例：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意：严格模式不允许默认绑定，所以 <code>this</code> 将会是 <code>undefined</code> ：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>隐式绑定：</strong>当使用一个对象的属性调用一个方法时，该对象就成了方法的执行上下文 <code>this</code>。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj1 = &#123;</span><br><span class="line">  name: <span class="string">"Pulsar"</span>,</span><br><span class="line">  bike: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> obj2 = &#123; <span class="attr">name</span>: <span class="string">"Gixxer"</span>, <span class="attr">bike</span>: obj1.bike &#125;;</span><br><span class="line"><span class="keyword">var</span> name = <span class="string">"Ninja"</span>;</span><br><span class="line"><span class="keyword">var</span> bike = obj1.bike;</span><br><span class="line"></span><br><span class="line">bike();           <span class="comment">// "Ninja"</span></span><br><span class="line">obj1.bike();      <span class="comment">// "Pulsar"</span></span><br><span class="line">obj2.bike();      <span class="comment">// "Gixxer"</span></span><br></pre></td></tr></table></figure><p>上面的代码中，直接调用 <code>bike()</code> 就是默认绑定， <code>obj1.bike()</code> 和 <code>obj2.bike()</code> 就是隐式绑定。</p><p><code>bike</code> 方法是 <code>obj1</code> 的一个属性，但是当我们执行 <code>obj2.bike()</code> 时，执行上下文是 <code>obj2</code> ，因此<code>obj2.name</code> 的值被打印出来。</p><p>所以，清楚什么时间、什么地方、以何种方式调用方法是很重要的，而方法的声明并不影响。</p><h2 id="This的显式绑定和硬绑定"><a href="#This的显式绑定和硬绑定" class="headerlink" title="This的显式绑定和硬绑定"></a>This的显式绑定和硬绑定</h2><p><strong>显式绑定：</strong>如果我们使用 <code>call</code> 和 <code>apply</code> 来调用方法，那么方法将以第一个参数来作为它的执行上下文。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bike</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">"Ninja"</span>;</span><br><span class="line"><span class="keyword">var</span> obj = &#123; <span class="attr">name</span>: <span class="string">"Pulsar"</span> &#125;</span><br><span class="line"></span><br><span class="line">bike();           <span class="comment">// "Ninja"</span></span><br><span class="line">bike.call(obj);   <span class="comment">// "Pulsar"</span></span><br></pre></td></tr></table></figure><p>上面的代码中，我们传递了一个对象 <code>obj</code> 作为 <code>call()</code> 的参数来调用 <code>bike</code> 方法，<code>obj</code> 就被指派到了 <code>this</code> ，输出<code>obj.name</code> 的值 “Pulsar” 。</p><p><strong>硬绑定：</strong>无论我们怎么调用方法，指定 <code>this</code> 对象始终不变。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bike = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> name = <span class="string">"Ninja"</span>;</span><br><span class="line"><span class="keyword">var</span> obj1 = &#123; <span class="attr">name</span>: <span class="string">"Pulsar"</span> &#125;;</span><br><span class="line"><span class="keyword">var</span> obj2 = &#123; <span class="attr">name</span>: <span class="string">"Gixxer"</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> originalBikeFun = bike;</span><br><span class="line">bike = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  originalBikeFun.call(obj1);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">bike();           <span class="comment">// "Pulsar"</span></span><br><span class="line">bike.call(obj2);  <span class="comment">// "Pulsar"</span></span><br></pre></td></tr></table></figure><p>上面的代码中使用了<code>originalBikeFun.call(obj1);</code> ，使得 <code>bike()</code> 和 <code>bike.call(obj2)</code> 都输出<code>obj1.name</code> 的值。</p><h2 id="JavaScript中的new关键字"><a href="#JavaScript中的new关键字" class="headerlink" title="JavaScript中的new关键字"></a>JavaScript中的new关键字</h2><p>任何方法之前的 <code>new</code> 关键字会调用方法的 <code>constructor</code> ，然后产生下面的结果：</p><ul><li>产生一个新的空的对象；</li><li>该新对象关联到方法的 <code>prototype</code> 属性；</li><li>该新对象被绑定为 <code>this</code> 关键字，将作为方法的执行上下文；</li><li>如果方法没有返回任何值，那将隐性的返回 this 对象。</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bike</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> name = <span class="string">"Ninja"</span>;</span><br><span class="line">  <span class="keyword">this</span>.maker = <span class="string">"Kawasaki"</span>;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="keyword">this</span>.name + <span class="string">" "</span> + maker);  <span class="comment">// undefined Bajaj</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">"Pulsar"</span>;</span><br><span class="line"><span class="keyword">var</span> maker = <span class="string">"Bajaj"</span>;</span><br><span class="line"></span><br><span class="line">obj = <span class="keyword">new</span> bike();</span><br><span class="line"><span class="built_in">console</span>.log(obj.maker);                  <span class="comment">// "Kawasaki"</span></span><br></pre></td></tr></table></figure><p>上面的代码中，<code>bike</code> 方法前面使用了 <code>new</code> ，因此它将创建一个新对象连接到 <code>bike</code> 方法的原型链, 然后该对象绑定到 <code>this</code> 从而被返回。因此返回的 <code>this</code> 对象被分配到 <code>obj</code> 然后<code>console.log(obj.maker)</code> 打印出 “Kawasaki” 。</p><p>同样是上面的代码，方法里面的 <code>this.name</code> 没有打印出 “Ninja” 或者 “Pulsar” ，反而是 <code>undefined</code> 。因为 <code>name</code> 是在方法里面被声明，和 <code>this.name</code> 是完全不同的。同样， <code>this.maker</code> 和 <code>maker</code> 也是不同的。</p><h2 id="This绑定顺序"><a href="#This绑定顺序" class="headerlink" title="This绑定顺序"></a>This绑定顺序</h2><ul><li>首先检查方法是否用 <code>new</code> 来调用;</li><li>然后检查方法是否是被 <code>call()</code> 或者 <code>apply()</code> 方法来调用;</li><li>其次检查方法是否是通过对象上下文来调用;</li><li>默认全局对象（严格模式是 <code>undefined</code> ）。</li></ul><p>原文链接：<a href="https://codeburst.io/all-about-this-and-new-keywords-in-javascript-38039f71780c" target="_blank" rel="noopener">https://codeburst.io/all-about-this-and-new-keywords-in-javascript-38039f71780c</a></p><p>参考链接：<a href="https://segmentfault.com/a/1190000004460913" target="_blank" rel="noopener">https://segmentfault.com/a/1190000004460913</a></p></div><footer class="article-footer"><a data-url="http://blog.moyufed.com/2020/03/31/JavaScript的this关键字/" data-id="ck8k1iwkh0001z4vy9qm2fse0" class="article-share-link">Share</a></footer></div></article><article id="post-File-APIs（Blob-BlobURL-ArrayBuffer-FileReader）" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2020/03/31/File-APIs（Blob-BlobURL-ArrayBuffer-FileReader）/" class="article-date"><time datetime="2020-03-31T06:13:32.000Z" itemprop="datePublished">2020-03-30</time></a></div><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2020/03/31/File-APIs（Blob-BlobURL-ArrayBuffer-FileReader）/">File APIs（Blob, BlobURL, ArrayBuffer, FileReader）</a></h1></header><div class="article-entry" itemprop="articleBody"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>以前的JavaScript很不擅长处理二进制数据，要将二进制数据保存在浏览器上使用需要牺牲1.3倍的存储空间（将数据转换成 <code>DataURI</code> ）。即使是使用 <code>XHR</code> 从服务器请求数据，将读入内存之后还需要转换成 <code>Base64</code> / <code>DataURI</code> ），过程十分繁琐。</p><p>但是，时代已经变了。</p><p>现在的JavaScript中，处理二进制数据已经不是难题。硬件和 JIT（just-in-time）编译器的升级，让H5实现大多数API来处理大容量的二进制数据。</p><p>下面来介绍HTML5的Blob, File, FileList等对象，以及它们之间的相互转换。</p><h2 id="HTML5的File-API和对象"><a href="#HTML5的File-API和对象" class="headerlink" title="HTML5的File API和对象"></a>HTML5的File API和对象</h2><h3 id="Blob"><a href="#Blob" class="headerlink" title="Blob"></a>Blob</h3><p>Blob可以更好的处理二进制数据和文件：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Blob</span> </span>&#123;</span><br><span class="line">    readonly size: UINT64 = <span class="number">0</span>,</span><br><span class="line">    readonly type: <span class="built_in">String</span> = <span class="string">""</span>,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>(source:AnyArray, option:BlobTypeObject = null):Blob &#123; &#125;,</span><br><span class="line">    slice(start:INT64 = <span class="number">0</span>, <span class="attr">end</span>:INT64 = <span class="number">0</span>, <span class="attr">contentType</span>:<span class="built_in">String</span> = <span class="string">""</span>):Blob &#123; &#125;,</span><br><span class="line">    close():<span class="keyword">void</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BlobTypeObject</span> </span>&#123;</span><br><span class="line">    readonly type: <span class="built_in">String</span> = <span class="string">""</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Blob具有 <code>size</code> 和 <code>type</code> 属性，并且还有 <code>slice</code> 和 <code>close</code> 方法，可以在 <code>ArrayBuffer</code> 或 <code>BlobURL</code> 之间相互转换。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> source = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>([ <span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span> ]);</span><br><span class="line"><span class="keyword">var</span> blob = <span class="keyword">new</span> Blob([ source ]);</span><br><span class="line"><span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line"></span><br><span class="line">reader.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(reader.result); <span class="comment">// reader.result 是 ArrayBuffer</span></span><br><span class="line">&#125;;</span><br><span class="line">reader.readAsArrayBuffer(blob);</span><br></pre></td></tr></table></figure><p>Blob构造器的第一参数指定一个数组，这个数组的元素类型可以是 <code>Blob</code> 、<code>ArrayBuffer</code> 、<code>TypedArray</code>、<code>String</code> 或 <code>Object</code> 。如果是 <code>Object</code> 的情况还需要用 <code>toString</code> 方法转换成字符串。如果有多个项的情况，将按照顺序链接Blob对象内容。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个空的Blob对象</span></span><br><span class="line"><span class="keyword">var</span> blob = <span class="keyword">new</span> Blob();</span><br></pre></td></tr></table></figure><p>Blob的第二个参数指定了 <code>{ type: MimeTypeString }</code> ，<code>MimeTypeString</code> 设置了Blob的种类 <code>MimeType</code> 。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个 octet-binary Blob 对象</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> buffer1 = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">var</span> buffer2 = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> blob = <span class="keyword">new</span> Blob([buffer1, buffer2], &#123; <span class="attr">type</span>: <span class="string">"application/octet-binary"</span> &#125;);</span><br></pre></td></tr></table></figure><p>通常使用二进制数据时会指定类型，如： <code>{ type: &quot;application/octet-binary&quot; }</code> 。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> blob = <span class="keyword">new</span> Blob([file], &#123; <span class="attr">type</span>: <span class="string">"image/png"</span> &#125;);</span><br><span class="line"><span class="keyword">var</span> blob = <span class="keyword">new</span> Blob([binary], &#123; <span class="attr">type</span>: <span class="string">"application/octet-binary"</span> &#125;);</span><br><span class="line"><span class="keyword">var</span> blob = <span class="keyword">new</span> Blob([<span class="string">"字符串"</span>], &#123; <span class="attr">type</span>: <span class="string">"text/plain"</span> &#125;);</span><br><span class="line"><span class="keyword">var</span> blob = <span class="keyword">new</span> Blob([<span class="string">"&lt;html&gt;"</span>], &#123; <span class="attr">type</span>: <span class="string">"text/plain;charset=UTF-8"</span> &#125;);</span><br></pre></td></tr></table></figure><h3 id="File"><a href="#File" class="headerlink" title="File"></a>File</h3><p>File继承了Blob对象。并且追加了Blob的 <code>{ name:String, lastModifiedDate:Date }</code> 属性，File 是 JavaScript 中少数处理本地文件方法的一种。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> <span class="keyword">extends</span> <span class="title">Blob</span> </span>&#123;</span><br><span class="line">    readonly name: <span class="built_in">String</span> = <span class="string">""</span>,</span><br><span class="line">    readonly lastModifiedDate: <span class="built_in">Date</span> = <span class="literal">null</span>,</span><br><span class="line">    readonly webkitRelativePath: <span class="built_in">String</span> = <span class="string">""</span>,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>(source:Blob, fileName:String):File &#123; &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在Chrome中，File的构造器需要指定一个数组： <code>new File([], ...)</code> ，扩展了 <code>{ lastModified: Integer, webkitRelativePath: String }</code> 。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Chrome的示例</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> <span class="keyword">extends</span> <span class="title">Blob</span> </span>&#123;</span><br><span class="line">    readonly name: <span class="built_in">String</span> = <span class="string">""</span>,</span><br><span class="line">    readonly lastModified: Integer = <span class="number">0</span>,</span><br><span class="line">    readonly lastModifiedDate: <span class="built_in">Date</span> = <span class="literal">null</span>,</span><br><span class="line">    readonly webkitRelativePath: <span class="built_in">String</span> = <span class="string">""</span>,</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>(source:AnyArray, fileName:String):File &#123; &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>由于File继承了Blob，因此File也支持使用 <code>FileReader.readAsArrayBuffer()</code> API转换为Blob。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line"></span><br><span class="line">reader.readAsArrayBuffer(file);</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_toBlob</span>(<span class="params">url, callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    xhr.responseType = <span class="string">"blob"</span>;</span><br><span class="line">    xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        callback(xhr.response, url);</span><br><span class="line">    &#125;;</span><br><span class="line">    xhr.open(<span class="string">"GET"</span>, url);</span><br><span class="line">    xhr.send();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">_toBlob(location.href, <span class="function"><span class="keyword">function</span>(<span class="params">blob</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> blobURL = URL.createObjectURL(blob);</span><br><span class="line">    <span class="keyword">var</span> file = <span class="keyword">new</span> File([blob], <span class="string">"foo.html"</span>); <span class="comment">// 或者是 new File(blob, ...)</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="FileList"><a href="#FileList" class="headerlink" title="FileList"></a>FileList</h3><p><code>FileList</code> 是通过DOM如 <code>&lt;input type=&quot;file&quot; multiple=&quot;multiple&quot;&gt;</code> 的 <code>onchange</code> 取得的File的列表。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">'input[type="file"]'</span>).addEventListener(<span class="string">"change"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> fileList = event.target.files; <span class="comment">// ArrayLikeObject</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, iz = fileList.length; i &lt; iz; ++i) &#123;</span><br><span class="line">        <span class="keyword">var</span> file = fileList[<span class="number">0</span>];</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileList</span> </span>&#123;</span><br><span class="line">    readonly length: UINT32 = <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line">    item(index:UINT32):File &#123; &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="FileReader"><a href="#FileReader" class="headerlink" title="FileReader"></a>FileReader</h3><p><code>FileReader</code> 类可以将二进制数据读入内存。</p><p>使用 <code>readAsArrayBuffer</code> 方法可以将 <code>Blob</code> 转换成 <code>ArrayBuffer</code> ，转换的结果通过 <code>result</code> 属性进行设置，同样可以使用 <code>readAsDataURL</code> 或 <code>readAsText</code> 等方法进行转换。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileReader</span> <span class="keyword">extends</span> <span class="title">EventHandler</span> </span>&#123;</span><br><span class="line">    EMPTY:   UINT16 = <span class="number">0</span>,</span><br><span class="line">    LOADING: UINT16 = <span class="number">1</span>,</span><br><span class="line">    DONE:    UINT16 = <span class="number">2</span>,</span><br><span class="line">    readonly error: <span class="built_in">Error</span> = <span class="literal">null</span>,</span><br><span class="line">    readonly result: <span class="built_in">ArrayBuffer</span>|<span class="built_in">String</span> = <span class="literal">null</span>,</span><br><span class="line">    readonly readyState: UINT16 = EMPTY,</span><br><span class="line">    onload:      EventHandler = <span class="literal">null</span>,</span><br><span class="line">    onloadstart: EventHandler = <span class="literal">null</span>,</span><br><span class="line">    onloadend:   EventHandler = <span class="literal">null</span>,</span><br><span class="line">    onprogress:  EventHandler = <span class="literal">null</span>,</span><br><span class="line">    onabort:     EventHandler = <span class="literal">null</span>,</span><br><span class="line">    onerror:     EventHandler = <span class="literal">null</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">// async read methods</span></span><br><span class="line">    readAsArrayBuffer(blob:Blob): <span class="keyword">void</span> &#123;&#125;,</span><br><span class="line">    readAsDataURL(blob:Blob):<span class="keyword">void</span> &#123;&#125;,</span><br><span class="line">    readAsText(blob:Blob, <span class="attr">label</span>:<span class="built_in">String</span> = <span class="string">""</span>):<span class="keyword">void</span> &#123;&#125;,</span><br><span class="line"></span><br><span class="line">    abort():<span class="keyword">void</span> &#123;&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Chrome中还有 <code>readAsBinaryString(blob:Blob):void {}</code> 方法。</p><h3 id="BlobURL生成和释放"><a href="#BlobURL生成和释放" class="headerlink" title="BlobURL生成和释放"></a>BlobURL生成和释放</h3><h4 id="生成"><a href="#生成" class="headerlink" title="生成"></a>生成</h4><p><code>BlobURL</code> 是 <code>blob:...</code> 的形式的假象URL，可以通过 <code>URL.createObjectURL(source:Blob):BlobURLString</code> 来动态生成：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> uint8Array = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br><span class="line"><span class="keyword">var</span> blob = <span class="keyword">new</span> Blob([uint8Array], &#123; <span class="attr">type</span>: <span class="string">"application/octet-binary"</span> &#125;);</span><br><span class="line"><span class="keyword">var</span> blobURL = URL.createObjectURL(blob); <span class="comment">// "blob:http%3A//dev.w3.org/207c851d-7486-42ec-97b1-d3cd26d08ed9"</span></span><br></pre></td></tr></table></figure><p><code>URL.createObjectURL</code> 总是生成唯一的 <code>BlobURL</code> （对于同一个资源每次都会生成不同的URL），生成的 <code>BlobURL</code> 在浏览器关闭之前有效。</p><h4 id="释放"><a href="#释放" class="headerlink" title="释放"></a>释放</h4><p>如果要释放BlobURL，可以调用 <code>URL.revokeObjectURL(blobURL:BlobURLString):void</code> 方法。当然，也有 <code>URL.createFor(Blob):BlobURLString</code> 创建可以自动释放的BlobURL，不过要考虑兼容性。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> blobURL = URL.createObjectURL(file);</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">URL.revokeObjectURL(blobURL);</span><br></pre></td></tr></table></figure><p><code>img.src</code> 、 <code>XMLHttpRequest.open(method, URL)</code> 、<code>Audio</code> 等需要使用 URL 请求文件的情况，也可以通过生成BlobURL发送。</p><p>与DataURI时相比，使用BlobURL在速度和内存占用方面都更有优势，尤其是处理Audio等流式传输数据时，其差异会更明显。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> img = <span class="built_in">document</span>.createElement(<span class="string">"img"</span>);</span><br><span class="line">img.src = blobURL;</span><br></pre></td></tr></table></figure><p>Chrome可以通过访问chrome://blob-internals/来确认有效的BlobURL。</p><h2 id="相互转换"><a href="#相互转换" class="headerlink" title="相互转换"></a>相互转换</h2><h3 id="Blob-File-BlobURL的相互转换"><a href="#Blob-File-BlobURL的相互转换" class="headerlink" title="Blob, File, BlobURL的相互转换"></a>Blob, File, BlobURL的相互转换</h3><p>BlobURL可以通过XMLHttpRequest转换成Blob或者ArrayBuffer等其它类型。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = xhr.response; <span class="comment">// ArrayBuffer</span></span><br><span class="line">&#125;;</span><br><span class="line">xhr.responseType = <span class="string">"arraybuffer"</span>;</span><br><span class="line"><span class="comment">//xhr.responseType = "blob";</span></span><br><span class="line">xhr.open(<span class="string">"GET"</span>, blobURL);</span><br><span class="line">xhr.send();</span><br></pre></td></tr></table></figure><p>Blob,，BlobURLString， ArrayBuffer的相互转换可以通过以下方法：</p><table><thead><tr><th style="text-align:left">原始</th><th style="text-align:left">目标</th><th style="text-align:left">方法</th></tr></thead><tbody><tr><td style="text-align:left">Blob/File</td><td style="text-align:left">BlobURLString</td><td style="text-align:left">URL.createObjectURL(…)</td></tr><tr><td style="text-align:left">BlobURL</td><td style="text-align:left">Blob</td><td style="text-align:left">XMLHttpRequest#responseType = “blob”</td></tr><tr><td style="text-align:left">BlobURL</td><td style="text-align:left">ArrayBuffer</td><td style="text-align:left">XMLHttpRequest#responseType = “arraybuffer”</td></tr><tr><td style="text-align:left">Blob/File</td><td style="text-align:left">ArrayBuffer</td><td style="text-align:left">FileReader#readAsArrayBuffer(…)</td></tr><tr><td style="text-align:left">Blob/File</td><td style="text-align:left">BinaryString</td><td style="text-align:left">FileReader#readAsBinaryString(…)</td></tr><tr><td style="text-align:left">Blob/File</td><td style="text-align:left">DataURLString</td><td style="text-align:left">FileReader#readAsDataURL(…)</td></tr><tr><td style="text-align:left">Blob/File</td><td style="text-align:left">String</td><td style="text-align:left">FileReader#readAsText(…, 编码方式)</td></tr></tbody></table><p>转换ArryBuffer的方式可以如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_toArrayBuffer</span>(<span class="params">source,     <span class="regexp">//</span> @arg BlobURLString|URLString|Blob|File|TypedArray|ArrayBuffer</span></span></span><br><span class="line"><span class="function"><span class="params">                        callback</span>) </span>&#123; <span class="comment">// @arg Function - callback(result:ArrayBuffer, source:Any):void</span></span><br><span class="line">    <span class="keyword">if</span> (source.buffer) &#123;</span><br><span class="line">        <span class="comment">// TypedArray</span></span><br><span class="line">        callback(source.buffer, source);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (source <span class="keyword">instanceof</span> <span class="built_in">ArrayBuffer</span>) &#123;</span><br><span class="line">        <span class="comment">// ArrayBuffer</span></span><br><span class="line">        callback(source, source);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (source <span class="keyword">instanceof</span> Blob) &#123;</span><br><span class="line">        <span class="comment">// Blob or File</span></span><br><span class="line">        <span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line">        reader.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            callback(reader.result, source);</span><br><span class="line">        &#125;;</span><br><span class="line">        reader.readAsArrayBuffer(source);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> source === <span class="string">"string"</span>) &#123;</span><br><span class="line">        <span class="comment">// BlobURLString or URLString</span></span><br><span class="line">        <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">        xhr.responseType = <span class="string">"arraybuffer"</span>;</span><br><span class="line">        xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            callback(xhr.response, source);</span><br><span class="line">        &#125;;</span><br><span class="line">        xhr.open(<span class="string">"GET"</span>, source);</span><br><span class="line">        xhr.send();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">"Unknown type"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>FileReader#readAsText(blob, &quot;UTF-8&quot;)</code> 第二个参数可以指定编码方式，默认为 “UTF-8” ：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reader = <span class="keyword">new</span> FileReader();</span><br><span class="line"></span><br><span class="line">reader.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> buffer = reader.result; <span class="comment">// String</span></span><br><span class="line">&#125;;</span><br><span class="line">reader.readAsText(file, <span class="string">"UTF-16"</span>);</span><br></pre></td></tr></table></figure><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p>《File APIs(Blob, BlobURL, ArrayBuffer, FileReader)》：<a href="https://qiita.com/TypoScript/items/0d5b08cecf959b8b822c" target="_blank" rel="noopener">https://qiita.com/TypoScript/items/0d5b08cecf959b8b822c</a></p></div><footer class="article-footer"><a data-url="http://blog.moyufed.com/2020/03/31/File-APIs（Blob-BlobURL-ArrayBuffer-FileReader）/" data-id="ck8k1iwkc0000z4vyezng6peb" class="article-share-link">Share</a></footer></div></article><article id="post-使用Taro开发一个微信小程序一" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2019/12/17/使用Taro开发一个微信小程序一/" class="article-date"><time datetime="2019-12-17T05:02:46.000Z" itemprop="datePublished">2019-12-16</time></a></div><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2019/12/17/使用Taro开发一个微信小程序一/">使用Taro开发一个微信小程序一</a></h1></header><div class="article-entry" itemprop="articleBody"><h1 id="使用Taro开发一个微信小程序（一），小程序注册、项目创建"><a href="#使用Taro开发一个微信小程序（一），小程序注册、项目创建" class="headerlink" title="使用Taro开发一个微信小程序（一），小程序注册、项目创建"></a>使用Taro开发一个微信小程序（一），小程序注册、项目创建</h1><p>视频地址：<a href="https://www.bilibili.com/video/av76872374/" target="_blank" rel="noopener">https://www.bilibili.com/video/av76872374/</a></p><h3 id="为什么使用Taro"><a href="#为什么使用Taro" class="headerlink" title="为什么使用Taro"></a>为什么使用Taro</h3><ul><li>Taro是一个支持多端开发的框架，写一套代码可以编译成各主流小程序，并且包括H5和RN。</li><li>和React接轨，方便在React和Taro之间无缝切换，学习门槛不会太高。</li></ul><p>关于Taro技术选型，这里有一篇介绍，<a href="http://blog.moyufed.com/2019/11/23/Taro%E6%8A%80%E6%9C%AF%E9%80%89%E5%9E%8B%E4%B8%8E%E6%9D%83%E8%A1%A1/">去查看</a> 。</p><h3 id="注册小程序"><a href="#注册小程序" class="headerlink" title="注册小程序"></a>注册小程序</h3><ol><li>注册小程序需要一个电子邮箱，然后进入<a href="https://mp.weixin.qq.com/" target="_blank" rel="noopener">微信公众平台</a>，点击 【立即注册】。</li><li>进入到账号类型选择，点击【小程序】，注意，<strong>一个邮箱只能注册一个账号类型，这些账号可以关联到同一个微信号</strong> 。</li><li>完善注册信息，需要输入邮箱地址、密码并且确认密码，填入验证码之后点击【注册】。</li><li>注册之后，会提示验证邮箱，点击【登录邮箱】去到收件箱找到微信发送的邮件，点击详情里面的链接完成验证。</li><li>完善微信小程序主体信息，包括账号地区、主体类型（个人）、以及主体的信息，然后使用微信二维码扫描验证。</li><li>提交信息完成之后，即可点击【前往小程序】跳转到小程序管理页面，到这步，我们已经完成了小程序的注册。</li></ol><h3 id="下载安装微信开发工具"><a href="#下载安装微信开发工具" class="headerlink" title="下载安装微信开发工具"></a>下载安装微信开发工具</h3><p>在进行微信小程序开发的过程中，我们需要使用到微信开发工具，<a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/download.html" target="_blank" rel="noopener">点击进入</a>，我们可以选择自己喜欢的版本进行下载，下载完成之后双击执行安装，不多做介绍。</p><h3 id="下载Taro"><a href="#下载Taro" class="headerlink" title="下载Taro"></a>下载Taro</h3><p>详细详情，可以参考<a href="https://taro-docs.jd.com/taro/docs/GETTING-STARTED.html" target="_blank" rel="noopener">Taro文档</a> ，下面做要点介绍：</p><p>首先检查 <code>nodejs</code> 版本，打开命令行工具（本人使用 ConEmu ），在命令行执行：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ node -v</span><br><span class="line">v8.<span class="number">10.0</span></span><br></pre></td></tr></table></figure><blockquote><p>Taro 项目基于 node，请确保已具备较新的 node 环境（&gt;=8.0.0），推荐使用 node 版本管理工具 <a href="https://github.com/creationix/nvm" target="_blank" rel="noopener">nvm</a> 来管理 node，这样不仅可以很方便地切换 node 版本，而且全局安装时候也不用加 sudo 了。</p></blockquote><p>关于 nvm 安装，这里有一个介绍视频，<a href="https://www.bilibili.com/video/av71367431/" target="_blank" rel="noopener">点击查看</a> 。接着执行命令安装Taro：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g @tarojs/cli</span><br></pre></td></tr></table></figure><p>为了避免我们在使用 <code>sass</code> 时出现安装安装错误，可以再全局安装<a href="https://www.npmjs.com/package/mirror-config-china" target="_blank" rel="noopener"><code>mirror-config-china</code></a>：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g mirror-config-china</span><br></pre></td></tr></table></figure><p>安装完成之后，可以执行命令查看Taro的信息：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ taro info</span><br><span class="line">👽 Taro v1.<span class="number">3.25</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  Taro CLI <span class="number">1.3</span>.<span class="number">25</span> environment info:</span><br><span class="line">    System:</span><br><span class="line">      OS: Windows <span class="number">10</span></span><br><span class="line">    Binaries:</span><br><span class="line">      Node: <span class="number">8.10</span>.<span class="number">0</span> - C:\Program Files\nodejs\node.EXE</span><br><span class="line">      Yarn: <span class="number">1.19</span>.<span class="number">1</span> - C:\Program Files (x86)\Yarn\bin\yarn.CMD</span><br><span class="line">      npm: <span class="number">5.6</span>.<span class="number">0</span> - C:\Program Files\nodejs\npm.CMD</span><br></pre></td></tr></table></figure><h3 id="创建第一个-Taro-项目"><a href="#创建第一个-Taro-项目" class="headerlink" title="创建第一个 Taro 项目"></a>创建第一个 Taro 项目</h3><p>执行命令创建项目：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ taro init 项目名称</span><br><span class="line"></span><br><span class="line"><span class="comment"># 以本次实战项目为例</span></span><br><span class="line">$ taro init moyufed</span><br><span class="line">√ 拉取远程模板仓库成功！</span><br><span class="line">? 请输入项目名称！ moyufed</span><br><span class="line">? 请输入项目介绍！ 项目介绍</span><br><span class="line">? 是否需要使用 TypeScript ？ No</span><br><span class="line">? 请选择 CSS 预处理器（Sass/Less/Stylus） Sass</span><br><span class="line">? 请选择模板 mobx</span><br></pre></td></tr></table></figure><p>执行 <code>init</code> 之后，Taro 会自动执行依赖的安装。如果执行安装失败，我们可以按 ctrl+c 结束，手动执行命令安装：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 yarn 安装依赖</span></span><br><span class="line">$ yarn install</span><br><span class="line"><span class="comment"># 或者使用 npm 安装依赖</span></span><br><span class="line">$ npm install</span><br></pre></td></tr></table></figure><p>执行命令启动：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 yarn</span></span><br><span class="line">$ yarn dev:weapp</span><br><span class="line">$ yarn build:weapp</span><br><span class="line"><span class="comment"># 使用 npm script</span></span><br><span class="line">$ npm run dev:weapp</span><br><span class="line">$ npm run build:weapp</span><br></pre></td></tr></table></figure><h3 id="运行和预览"><a href="#运行和预览" class="headerlink" title="运行和预览"></a>运行和预览</h3><p>打开已经下载安装好的微信开发工具，用自己的微信扫描登录。然后进入项目目录，执行命令启动dev ：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 yarn</span></span><br><span class="line">$ yarn dev:weapp</span><br><span class="line"><span class="comment"># 使用 npm script</span></span><br><span class="line">$ npm run dev:weapp</span><br></pre></td></tr></table></figure><p>为了能够使用刚注册好的小程序进行预览，先去完善小程序信息：</p><ol><li>进入微信公众平台小程序首页，点击小程序信息栏目的【填写】前往信息完善页面，完善和提交小程序信息之后，点击右侧【开发】菜单，选择【开发设置】标签，可以看到小程序ID，复制小程序ID，填入项目根目录的 <code>project.config.json</code> ，修改<code>appid</code> 的值为小程序的ID。</li><li>在小程序开发工具中，点击新建小程序，选择【导入项目】，下拉选择我们创建的小程序项目根文件夹，点击【导入】，这时我们就可以边修改代码边查看小程序效果了。</li></ol><p>更多详情，可以点击文章开头的视频连接查看。</p></div><footer class="article-footer"><a data-url="http://blog.moyufed.com/2019/12/17/使用Taro开发一个微信小程序一/" data-id="ck8k1iwmg000oz4vy99ld776i" class="article-share-link">Share</a></footer></div></article><article id="post-个人账单和砸金蛋前端动画分享" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2019/11/24/个人账单和砸金蛋前端动画分享/" class="article-date"><time datetime="2019-11-24T07:31:33.000Z" itemprop="datePublished">2019-11-23</time></a></div><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2019/11/24/个人账单和砸金蛋前端动画分享/">个人账单和砸金蛋前端动画分享</a></h1></header><div class="article-entry" itemprop="articleBody"><p>我们在前端开发过程中，有时候实现一些页面效果需要用到CSS3动画，比如活动页面、抽奖页面、个人账单等。我们可以照着设计师给的效果实现，但是我们追求的不止是这样，我们需要实现精致的动画，流畅的体验，还有新颖的交互。下面分享我在做个人账单、砸蛋抽奖过程中的心得。</p><h4 id="开发之前需要和产品与设计进行相关内容的确认"><a href="#开发之前需要和产品与设计进行相关内容的确认" class="headerlink" title="开发之前需要和产品与设计进行相关内容的确认"></a>开发之前需要和产品与设计进行相关内容的确认</h4><p>为了提高效率、减少开发难度、避免重复劳动，我们需要提前做好准备：</p><ul><li>产品和设计并提出的需求也许和实现冲突，作为开发人员需要与其确认可行的方案。</li></ul><ul><li>向设计确认设计规范、适配等，或者提出自己认为更好的效果，按照规范进行设计有利于效果和动画实现。</li><li>确认效果图是否符合规范，设计师切图是否有明确的标注，图片是否压缩。</li></ul><h4 id="Transitions-Transforms和Animation简介"><a href="#Transitions-Transforms和Animation简介" class="headerlink" title="Transitions, Transforms和Animation简介"></a>Transitions, Transforms和Animation简介</h4><p>CSS3动画相关的几个属性是：<code>transition</code>, <code>transform</code>, <code>animation</code> ，分别可以理解为过渡属性，变换属性，动画属性。</p><h5 id="Transiton"><a href="#Transiton" class="headerlink" title="Transiton"></a>Transiton</h5><p><code>transiton</code> 属性是一个简写属性，用于设置四个过渡属性：</p><ul><li><p><code>transition-property</code> 指定过渡的CSS属性值，比如 <code>transition-property:opacity</code> 就是只指定 <code>opacity</code> 属性参与这个过渡， 还可以使用 <code>all</code> 指定所有的属性值。</p></li><li><p><code>transition-duration</code> 指定过渡的持续时间</p></li><li><p><code>transition-delay</code> 延迟过渡时间</p></li><li><p><code>transition-timing-function</code> 指定过渡动画缓动类型，有<code>ease</code> | <code>linear</code> | <code>ease-in</code> | <code>ease-out</code> | <code>ease-in-out</code> | <code>cubic-bezier()</code>其中，<code>linear</code>线性过度，<code>ease-in</code>由慢到快，<code>ease-out</code>由快到慢，<code>ease-in-out</code>由慢到快在到慢。<br>我们通常使用简写 <em>transition: property duration timing-function delay;</em> ， 如：</p></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.global-wrap</span> <span class="selector-class">.bg</span> &#123;<span class="attribute">transition</span>: all <span class="number">1s</span> .<span class="number">6s</span> ease-out;&#125;</span><br></pre></td></tr></table></figure><p class="article-more-link"><a href="/2019/11/24/个人账单和砸金蛋前端动画分享/#more">Read More</a></p></div><footer class="article-footer"><a data-url="http://blog.moyufed.com/2019/11/24/个人账单和砸金蛋前端动画分享/" data-id="ck8k1iwni0013z4vy9f6bkr5e" class="article-share-link">Share</a></footer></div></article><article id="post-Taro技术选型与权衡" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2019/11/24/Taro技术选型与权衡/" class="article-date"><time datetime="2019-11-24T07:03:38.000Z" itemprop="datePublished">2019-11-23</time></a></div><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2019/11/24/Taro技术选型与权衡/">Taro技术选型与权衡</a></h1></header><div class="article-entry" itemprop="articleBody"><p>Taro 是由凹凸实验室打造的一套遵循 React 语法规范的多端统一开发框架。</p><p>今市面上应用的形态多种多样，Web、Native、微信小程序等，当业务要求同时在不同的端都要求有所表现的时候，针对不同的端去编写多套代码的成本显然非常高，这时候只编写一套代码就能够适配到多端的能力就显得极为需要。使用 Taro，我们可以只书写一套代码，再通过 Taro 的编译工具，将源代码分别编译出可以在不同端（微信小程序、H5、App 端等）运行的代码。</p><h3 id="Taro-有哪些特性"><a href="#Taro-有哪些特性" class="headerlink" title="Taro 有哪些特性"></a>Taro 有哪些特性</h3><ul><li><p>一键生成可以在微信小程序/H5/ReactNative等端运行的代码</p></li><li><p>采用React语法标准，支持JSX书写，现代的编辑器默认都对 JSX 进行了支持</p></li><li><p>支持组件化开发，让代码可以复用，让功能开发更加清晰</p></li><li>全面支持TypeScript</li><li>代码提示，实时代码检查，提升 开发效率</li><li>配套的开发工具Taro CLI实现开发流程自动化</li></ul><h3 id="Taro支持的平台"><a href="#Taro支持的平台" class="headerlink" title="Taro支持的平台"></a>Taro支持的平台</h3><ul><li>微信小程序</li><li>H5</li><li>React Native</li><li>支付宝小程序</li><li>百度智能小程序</li><li>字节跳动小程序</li><li>快应用（未上线）</li><li>QQ 浏览器轻应用 （未上线）</li></ul><h3 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h3><p>Taro 全都是 <code>Component</code> 组件，并且和 React 的生命周期完全一致。掌握了 React 就几乎掌握了 Taro。</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Taro, &#123; Component &#125; <span class="keyword">from</span> <span class="string">'@tarojs/taro'</span></span><br><span class="line"><span class="keyword">import</span> &#123; View, Button &#125; <span class="keyword">from</span> <span class="string">'@tarojs/components'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Index</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span> () &#123;</span><br><span class="line">    <span class="keyword">super</span>(...arguments)</span><br><span class="line">    <span class="keyword">this</span>.state = &#123;</span><br><span class="line">      title: <span class="string">'首页'</span>,</span><br><span class="line">      list: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  componentWillMount () &#123;&#125;</span><br><span class="line">  </span><br><span class="line">  componentDidMount () &#123;&#125;</span><br><span class="line">  </span><br><span class="line">  componentWillUpdate (nextProps, nextState) &#123;&#125;</span><br><span class="line">  </span><br><span class="line">  componentDidUpdate (prevProps, prevState) &#123;&#125;</span><br><span class="line">  </span><br><span class="line">  shouldComponentUpdate (nextProps, nextState) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  add = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// dosth</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  render () &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;View className=<span class="string">'index'</span>&gt;</span><br><span class="line">        &lt;View className=<span class="string">'title'</span>&gt;&#123;<span class="keyword">this</span>.state.title&#125;&lt;<span class="regexp">/View&gt;</span></span><br><span class="line"><span class="regexp">        &lt;View className='content'&gt;</span></span><br><span class="line"><span class="regexp">          &#123;this.state.list.map(item =&gt; &#123;</span></span><br><span class="line"><span class="regexp">            return (</span></span><br><span class="line"><span class="regexp">              &lt;View className='item'&gt;&#123;item&#125;&lt;/</span>View&gt;</span><br><span class="line">            )</span><br><span class="line">          &#125;)&#125;</span><br><span class="line">          &lt;Button className=<span class="string">'add'</span> onClick=&#123;<span class="keyword">this</span>.add&#125;&gt;添加&lt;<span class="regexp">/Button&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>View&gt;</span><br><span class="line">      &lt;<span class="regexp">/View&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><h3 id="技术选型与权衡"><a href="#技术选型与权衡" class="headerlink" title="技术选型与权衡"></a>技术选型与权衡</h3><h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><ul><li>一键生成可以在微信小程序/H5/ReactNative等端运行的代码，小程序端已支持微信小程序、支付宝小程序，但无法提供在线版，H5 端、RN 端可在线预览。</li><li>使用 <code>TypeScript</code> 来对代码的可靠性进一步增强，或使用 <code>PropsType</code> 在运行时进一步保障代码可靠性。</li><li>Taro 的所有 API（包括微信小程序等端能力接口）都有智能的提醒和自动补全，包括接口的参数和返回值。</li><li>Taro语法规范遵循React规范，熟悉React就能使用Taro进行开发。</li><li>使用JSX作为模板和业务代码系统，JSX 的本质就是 JavaScript 的语法增强，所以例如没有 <code>import</code> 组件等语法错误在编译期就能发现。</li><li>支持sass、less、postcss。</li><li>支持React 组件化规范，组件可复用多端。</li><li>内建构建系统+webpack自动构建</li><li>全面支持TypeScript</li></ul><h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><h5 id="React-like不完全等同-React"><a href="#React-like不完全等同-React" class="headerlink" title="React-like不完全等同 React"></a>React-like不完全等同 React</h5><ul><li>小程序中受限于 WXML 语法 ，组件调用不支持扩展操作符</li><li>JSX暂时只能写在render中</li></ul><h5 id="多端差异不可避免"><a href="#多端差异不可避免" class="headerlink" title="多端差异不可避免"></a>多端差异不可避免</h5><ul><li>某些功能在相应端上没有支持</li><li>样式支持、写法上存在差异</li></ul><h5 id="没有真正支持多端的UI组件库"><a href="#没有真正支持多端的UI组件库" class="headerlink" title="没有真正支持多端的UI组件库"></a>没有真正支持多端的UI组件库</h5><ul><li>Taro UI 是基于 Taro 框架开发的多端 UI 组件</li><li>Taro UI 暂不支持 React Native</li></ul><h4 id="存在的坑"><a href="#存在的坑" class="headerlink" title="存在的坑"></a>存在的坑</h4><h5 id="样式差异管理"><a href="#样式差异管理" class="headerlink" title="样式差异管理"></a>样式差异管理</h5><ul><li>因为 React Native 与一般 Web 样式支持度差异较大，用了大量 RN 不支持的样式再要去兼容 RN 无异于重写页面。</li><li>样式上 H5 最为灵活，小程序次之，RN 最弱，统一多端样式即是对齐短板，也就是要以 RN 的约束来管理样式，同时兼顾小程序的限制。</li></ul><h5 id="H5-端的坑"><a href="#H5-端的坑" class="headerlink" title="H5 端的坑"></a>H5 端的坑</h5><ul><li>Taro 对H5 端的支持度尚可，在 CSS 特性上就不用像 RN 那样拘束。</li><li>内置组件不够完善、端能力缺失较多，Taro 的设计是以微信小程序为基准。</li><li>小程序、RN 都没有跨域问题，但 H5 会有，这个可通过 devServer.proxy 解决</li><li>以及编译打包的静态资源是固定文件名，改成带 hash 值方便缓存管理，这些配置在项目里的 src/config 。</li></ul><h5 id="对React-Native-支持可能存在部分问题"><a href="#对React-Native-支持可能存在部分问题" class="headerlink" title="对React Native 支持可能存在部分问题"></a>对React Native 支持可能存在部分问题</h5><ul><li>React Native 不支持 text-overflow，而是提供原生支持 （Text 组件传入 numberOfLines={num} 属性）</li><li>React Native 的 view 不支持 click 事件，需要用 Touchable 组件</li></ul><h5 id="多端要求较高"><a href="#多端要求较高" class="headerlink" title="多端要求较高"></a>多端要求较高</h5><ul><li>对不同端的具体差异有所了解</li><li>样式实现较为苛刻，需兼顾多端、有所取舍</li><li>端能力差异可能需要自己填坑</li><li>需要对隔断差异做出取舍</li></ul><h5 id="新手使用"><a href="#新手使用" class="headerlink" title="新手使用"></a>新手使用</h5><ul><li>需要上手React、了解Redux数据流管理</li><li>和现有 ionic 组件会有出入的地方需要兼顾和取舍</li></ul><h3 id="多端填坑方式"><a href="#多端填坑方式" class="headerlink" title="多端填坑方式"></a>多端填坑方式</h3><ul><li>Taro 支持环境判断编译时只保留相应端代码</li><li>Taro 支持引入相应端的原生代码</li></ul><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (process.env.TARO_ENV === <span class="string">'weapp'</span>) &#123;</span><br><span class="line">    <span class="comment">// 微信小程序逻辑</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (process.env.TARO_ENV === <span class="string">'h5'</span>) &#123;</span><br><span class="line">    <span class="comment">// H5 逻辑</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (process.env.TARO_ENV === <span class="string">'rn'</span>) &#123;</span><br><span class="line">    <span class="comment">// RN 逻辑</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="技术和开发"><a href="#技术和开发" class="headerlink" title="技术和开发"></a>技术和开发</h3><ul><li>学习 React/Redux</li><li>采用自有UI组件和Taro UI，减少多端成本。</li><li>适配着重于兼容RN，小程序，根据多端差异协调取舍。</li><li>以H5为主、小程序为辅、RN次之的适配方案，能够快速应对项目二开，从了解到熟悉，循序渐进。</li></ul><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>Taro 虽然是以多端为设计目标，但重心是小程序端，RN 端目前的支持情况不算特别理想。但充分理解多端差异、掌握正确的多端开发的方式，在简单的项目上是完全值得尝试。</p></div><footer class="article-footer"><a data-url="http://blog.moyufed.com/2019/11/24/Taro技术选型与权衡/" data-id="ck8k1iwlf000ez4vyfzh6wdjx" class="article-share-link">Share</a></footer></div></article><article id="post-Windows下安装NVM" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2019/11/24/Windows下安装NVM/" class="article-date"><time datetime="2019-11-24T06:30:15.000Z" itemprop="datePublished">2019-11-23</time></a></div><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2019/11/24/Windows下安装NVM/">Windows下安装NVM</a></h1></header><div class="article-entry" itemprop="articleBody"><h1 id="Windows下安装NVM"><a href="#Windows下安装NVM" class="headerlink" title="Windows下安装NVM"></a>Windows下安装NVM</h1><p>视频地址：<a href="https://www.bilibili.com/video/av71367431/" target="_blank" rel="noopener">https://www.bilibili.com/video/av71367431/</a></p><h3 id="1、事先准备"><a href="#1、事先准备" class="headerlink" title="1、事先准备"></a>1、事先准备</h3><p>卸载已有的 <code>nodejs</code> ，并移除原有的 <code>nodejs</code> 目录（重要）</p><h3 id="2、下载和安装nvm"><a href="#2、下载和安装nvm" class="headerlink" title="2、下载和安装nvm"></a>2、下载和安装nvm</h3><p>访问 <a href="https://github.com/coreybutler/nvm-windows/releases" target="_blank" rel="noopener">下载地址</a> 选择自己需要的nvm版本进行下载，下载 <a href="https://github.com/coreybutler/nvm-windows/releases/download/1.1.7/nvm-setup.zip" target="_blank" rel="noopener">nvm-setup.zip</a> ，解压并执行里面的 <code>.exe</code> 文件进行安装</p><h3 id="3、修改为淘宝镜像"><a href="#3、修改为淘宝镜像" class="headerlink" title="3、修改为淘宝镜像"></a>3、修改为淘宝镜像</h3><p>以本机为例，修改 <code>C:\Users\Administrator\AppData\Roaming\nvm\settings.txt</code> 文件增加淘宝下载镜像地址：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root: C:\Users\Administrator\AppData\Roaming\nvm</span><br><span class="line">path: C:\Program Files\nodejs</span><br><span class="line">node_mirror: https://npm.taobao.org/mirrors/node/</span><br><span class="line">npm_mirror: https://npm.taobao.org/mirrors/npm/</span><br></pre></td></tr></table></figure><h3 id="4、打开CMD，执行nvm查看是否安装成功"><a href="#4、打开CMD，执行nvm查看是否安装成功" class="headerlink" title="4、打开CMD，执行nvm查看是否安装成功"></a>4、打开CMD，执行nvm查看是否安装成功</h3><p>1.nvm 安装，直接下载github 安装包即可。</p><p>2.nvm 安装成功后，需要手动的开启。</p><p>nvm on</p><p>3.不进行第二步，nvm install 8.9.0 ，输入node，依旧提示</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'node'</span> is not recognized as an internal or external command,</span><br><span class="line">operable program or batch file.</span><br></pre></td></tr></table></figure><h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p><a href="https://juejin.im/post/5cfde431e51d45775b419bac" target="_blank" rel="noopener">Win10 nvm 安装node 之 nvm on</a><br><a href="https://stackoverflow.com/questions/28313372/nvm-for-windows-not-working" target="_blank" rel="noopener">NVM for Windows not working?</a><br><a href="https://github.com/coreybutler/nvm-windows/issues/216" target="_blank" rel="noopener"><code>nvm node_mirror [url]</code> not work</a><br><a href="https://www.jianshu.com/p/d0e0935b150a" target="_blank" rel="noopener">nvm介绍及使用</a></p></div><footer class="article-footer"><a data-url="http://blog.moyufed.com/2019/11/24/Windows下安装NVM/" data-id="ck8k1iwlm000jz4vyajg8ckvr" class="article-share-link">Share</a></footer></div></article><article id="post-什么是DOM的事件委托" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2019/10/30/什么是DOM的事件委托/" class="article-date"><time datetime="2019-10-29T23:23:54.000Z" itemprop="datePublished">2019-10-29</time></a></div><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2019/10/30/什么是DOM的事件委托/">什么是DOM的事件委托</a></h1></header><div class="article-entry" itemprop="articleBody"><h3 id="DOM的事件委托"><a href="#DOM的事件委托" class="headerlink" title="DOM的事件委托"></a>DOM的事件委托</h3><p>DOM的事件委托（Event delegation）是通过事件 ”冒泡“ (event propagation) 来用单个父节点而非多个子节点响应 <a href="https://www.w3.org/TR/uievents/" target="_blank" rel="noopener">UI Events</a> 的技巧。</p><p class="article-more-link"><a href="/2019/10/30/什么是DOM的事件委托/#more">Read More</a></p></div><footer class="article-footer"><a data-url="http://blog.moyufed.com/2019/10/30/什么是DOM的事件委托/" data-id="ck8k1iwme000lz4vywvuo4jlj" class="article-share-link">Share</a><ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/前端/">前端</a></li></ul></footer></div></article><article id="post-MongoDB数据库备份导出和导入" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2019/09/06/MongoDB数据库备份导出和导入/" class="article-date"><time datetime="2019-09-05T23:39:22.000Z" itemprop="datePublished">2019-09-05</time></a></div><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2019/09/06/MongoDB数据库备份导出和导入/">MongoDB数据库备份导出和导入</a></h1></header><div class="article-entry" itemprop="articleBody"><h3 id="处理-MongoDB-远程数据库备份导出和导入"><a href="#处理-MongoDB-远程数据库备份导出和导入" class="headerlink" title="处理 MongoDB 远程数据库备份导出和导入"></a>处理 MongoDB 远程数据库备份导出和导入</h3><h4 id="导出备份"><a href="#导出备份" class="headerlink" title="导出备份"></a>导出备份</h4><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mongodump -h IP --port 端口 -u 用户名 -p 密码 -d 数据库 -o 文件存在路径</span><br></pre></td></tr></table></figure><p class="article-more-link"><a href="/2019/09/06/MongoDB数据库备份导出和导入/#more">Read More</a></p></div><footer class="article-footer"><a data-url="http://blog.moyufed.com/2019/09/06/MongoDB数据库备份导出和导入/" data-id="ck8k1iwlc000dz4vy1ehibrvn" class="article-share-link">Share</a><ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mongodb/">mongodb</a></li></ul></footer></div></article><article id="post-Linux中安装Nodejs和MongoBD以及MongoDB设置" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2019/09/05/Linux中安装Nodejs和MongoBD以及MongoDB设置/" class="article-date"><time datetime="2019-09-05T02:18:10.000Z" itemprop="datePublished">2019-09-04</time></a></div><div class="article-inner"><header class="article-header"><h1 itemprop="name"><a class="article-title" href="/2019/09/05/Linux中安装Nodejs和MongoBD以及MongoDB设置/">Linux中安装Nodejs和MongoBD以及MongoDB设置</a></h1></header><div class="article-entry" itemprop="articleBody"><h3 id="2020年1月21日更新"><a href="#2020年1月21日更新" class="headerlink" title="2020年1月21日更新"></a>2020年1月21日更新</h3><h4 id="关于nodejs镜像下载"><a href="#关于nodejs镜像下载" class="headerlink" title="关于nodejs镜像下载"></a>关于nodejs镜像下载</h4><p>关于nodejs的安装，可以去 <a href="https://npm.taobao.org/mirrors/node" target="_blank" rel="noopener">淘宝镜像</a> 寻找自己需要的版本进行下载，如：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ wget https://npm.taobao.org/mirrors/node/v12.<span class="number">14.1</span>/node-v12.<span class="number">14.1</span>-linux-x64.tar.gz</span><br><span class="line">$ tar -zxvf node-v12.<span class="number">14.1</span>-linux-x64.tar.gz</span><br></pre></td></tr></table></figure><h4 id="关于解压失败"><a href="#关于解压失败" class="headerlink" title="关于解压失败"></a>关于解压失败</h4><p>用tar解压xz格式文件时出错</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar (child): xz: Cannot exec: No such file or directory</span><br><span class="line">tar (child): Error is not recoverable: exiting now</span><br><span class="line">tar: Child returned status 2</span><br><span class="line">tar: Error is not recoverable: exiting now</span><br></pre></td></tr></table></figure><p>解决办法是安装xz软件包，执行如下命令：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ yum install xz -y</span><br></pre></td></tr></table></figure><h3 id="1、安装-nodejs"><a href="#1、安装-nodejs" class="headerlink" title="1、安装 nodejs"></a>1、安装 nodejs</h3><h4 id="方式一：使用已编译好的包"><a href="#方式一：使用已编译好的包" class="headerlink" title="方式一：使用已编译好的包"></a>方式一：使用已编译好的包</h4><p>首先来新建一个目录，下载nodejs：</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cd /usr</span><br><span class="line">$ mkdir software</span><br><span class="line">$ cd software/</span><br></pre></td></tr></table></figure><p class="article-more-link"><a href="/2019/09/05/Linux中安装Nodejs和MongoBD以及MongoDB设置/#more">Read More</a></p></div><footer class="article-footer"><a data-url="http://blog.moyufed.com/2019/09/05/Linux中安装Nodejs和MongoBD以及MongoDB设置/" data-id="ck8k1iwkk0002z4vykw62kkjd" class="article-share-link">Share</a><ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/nodejs/">nodejs</a></li></ul></footer></div></article><nav id="page-nav"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">下一页 &raquo;</a></nav></section><aside id="sidebar"><div class="widget-wrap"><h3 class="widget-title">标签</h3><div class="widget"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OnsenUI/">OnsenUI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Wcp/">Wcp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Webpack/">Webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/">nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/">react</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react-intl/">react-intl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react-redux/">react-redux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redux/">redux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端/">前端</a></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">标签云</h3><div class="widget tagcloud"><a href="/tags/Linux/" style="font-size:20px">Linux</a> <a href="/tags/Nginx/" style="font-size:10px">Nginx</a> <a href="/tags/OnsenUI/" style="font-size:10px">OnsenUI</a> <a href="/tags/React/" style="font-size:20px">React</a> <a href="/tags/Wcp/" style="font-size:10px">Wcp</a> <a href="/tags/Webpack/" style="font-size:10px">Webpack</a> <a href="/tags/mongodb/" style="font-size:20px">mongodb</a> <a href="/tags/nodejs/" style="font-size:10px">nodejs</a> <a href="/tags/react/" style="font-size:10px">react</a> <a href="/tags/react-intl/" style="font-size:10px">react-intl</a> <a href="/tags/react-redux/" style="font-size:10px">react-redux</a> <a href="/tags/redux/" style="font-size:10px">redux</a> <a href="/tags/前端/" style="font-size:10px">前端</a></div></div><div class="widget-wrap"><h3 class="widget-title">归档</h3><div class="widget"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">最新文章</h3><div class="widget"><ul><li><a href="/2020/04/04/【前端开发日常-18】快速配置webpack开发环境/">【前端开发日常 - 18】快速配置webpack开发环境</a></li><li><a href="/2020/03/31/JavaScript的this关键字/">JavaScript的this关键字</a></li><li><a href="/2020/03/31/File-APIs（Blob-BlobURL-ArrayBuffer-FileReader）/">File APIs（Blob, BlobURL, ArrayBuffer, FileReader）</a></li><li><a href="/2019/12/17/使用Taro开发一个微信小程序一/">使用Taro开发一个微信小程序一</a></li><li><a href="/2019/11/24/个人账单和砸金蛋前端动画分享/">个人账单和砸金蛋前端动画分享</a></li></ul></div></div></aside></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner">&copy; 2020 Moyufed<br>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a><br><a href="http://www.beian.miit.gov.cn" target="_blank">黔ICP备18007258号</a></div></div></footer></div><nav id="mobile-nav"><a href="/" class="mobile-nav-link">Home</a> <a href="/archives" class="mobile-nav-link">Archives</a></nav><script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script><link rel="stylesheet" href="/fancybox/jquery.fancybox.css"><script src="/fancybox/jquery.fancybox.pack.js"></script><script src="/js/script.js"></script></div></body>