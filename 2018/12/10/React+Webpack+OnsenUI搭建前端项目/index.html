<!DOCTYPE html><html><head><meta charset="utf-8"><title>React+Webpack+OnsenUI搭建前端项目 | Moyufed</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="1.环境准备安装高版本的nodejs良好的网络环境"><meta name="keywords" content="React,Webpack,OnsenUI"><meta property="og:type" content="article"><meta property="og:title" content="React+Webpack+OnsenUI搭建前端项目"><meta property="og:url" content="http://blog.moyufed.com/2018/12/10/React+Webpack+OnsenUI搭建前端项目/index.html"><meta property="og:site_name" content="Moyufed"><meta property="og:description" content="1.环境准备安装高版本的nodejs良好的网络环境"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2020-03-12T08:25:53.572Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="React+Webpack+OnsenUI搭建前端项目"><meta name="twitter:description" content="1.环境准备安装高版本的nodejs良好的网络环境"><link rel="alternate" href="/atom.xml" title="Moyufed" type="application/atom+xml"><link rel="icon" href="/favicon.png"><link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css"><link rel="stylesheet" href="/css/style.css"></head></html><body><div id="container"><div id="wrap"><header id="header"><div id="banner"></div><div id="header-outer" class="outer"><div id="header-title" class="inner"><h1 id="logo-wrap"><a href="/" id="logo">Moyufed</a></h1><h2 id="subtitle-wrap"><a href="/" id="subtitle">又摸到好大一条鱼，羡慕~！摸鱼前端分享交流，欢迎一起来摸鱼。</a></h2></div><div id="header-inner" class="inner"><nav id="main-nav"><a id="main-nav-toggle" class="nav-icon"></a> <a class="main-nav-link" href="/">Home</a> <a class="main-nav-link" href="/archives">Archives</a></nav><nav id="sub-nav"><a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a> <a id="nav-search-btn" class="nav-icon" title="搜索"></a></nav><div id="search-form-wrap"><form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://blog.moyufed.com"></form></div></div></div></header><div class="outer"><section id="main"><article id="post-React+Webpack+OnsenUI搭建前端项目" class="article article-type-post" itemscope itemprop="blogPost"><div class="article-meta"><a href="/2018/12/10/React+Webpack+OnsenUI搭建前端项目/" class="article-date"><time datetime="2018-12-10T02:18:13.000Z" itemprop="datePublished">2018-12-09</time></a></div><div class="article-inner"><header class="article-header"><h1 class="article-title" itemprop="name">React+Webpack+OnsenUI搭建前端项目</h1></header><div class="article-entry" itemprop="articleBody"><h3 id="1-环境准备"><a href="#1-环境准备" class="headerlink" title="1.环境准备"></a>1.环境准备</h3><ul><li>安装高版本的nodejs</li><li>良好的网络环境</li></ul><a id="more"></a><h3 id="2-搭建步骤"><a href="#2-搭建步骤" class="headerlink" title="2.搭建步骤"></a>2.搭建步骤</h3><h4 id="2-1创建项目"><a href="#2-1创建项目" class="headerlink" title="2.1创建项目"></a>2.1创建项目</h4><p>创建一个文件夹，并且在命令行进入这个文件夹，执行以下命令创建项目，这个命令会生成一个 <code>package.json</code> 文件到项目根目录。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init -y</span><br></pre></td></tr></table></figure><p>由于使用 <code>react</code> + <code>webpack</code> 开发，这里毫不犹豫的安装以下依赖：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack@2.6.1 --save-dev</span><br><span class="line">npm install webpack-dev-server@2.11.2 --save-dev</span><br><span class="line">npm install react react-dom --save</span><br></pre></td></tr></table></figure><h4 id="2-2配置入口文件"><a href="#2-2配置入口文件" class="headerlink" title="2.2配置入口文件"></a>2.2配置入口文件</h4><p>在项目根目录新建 <code>webpack.config.js</code> ，<code>app.js</code> 两个文件。</p><p>webpack.config.js 添加以下代码，目的是为了配置js入口，以及输出目录和输出文件名。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: [<span class="comment">// 'webpack/hot/dev-server',</span></span><br><span class="line">        <span class="comment">// 'webpack-dev-server/client?http://localhost:8080',</span></span><br><span class="line">        path.resolve(__dirname, <span class="string">'app.js'</span>)],</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'build'</span>),</span><br><span class="line">        <span class="comment">// publicPath: '/assets/', //表示资源的发布地址，当配置过该属性后，打包文件中所有通过相对路径引用的资源都会被配置的路径所替换。</span></span><br><span class="line">        filename: <span class="string">'bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>为了验证上面的代码是否生效，我们在package.json文件里面添加两个脚本。</p><p>如下：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"react"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">"react 练习"</span>,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"index.js"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"start"</span>: <span class="string">"webpack-dev-server --devtool eval --progress --colors --hot --content-base build --open"</span>,</span><br><span class="line">    <span class="attr">"build"</span>: <span class="string">"webpack"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"keywords"</span>: [],</span><br><span class="line">  <span class="attr">"author"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"license"</span>: <span class="string">"ISC"</span>,</span><br><span class="line">  <span class="attr">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"webpack"</span>: <span class="string">"^4.26.1"</span>,</span><br><span class="line">    <span class="attr">"webpack-cli"</span>: <span class="string">"^3.1.2"</span>,</span><br><span class="line">    <span class="attr">"webpack-dev-server"</span>: <span class="string">"^3.1.10"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"react"</span>: <span class="string">"^16.6.3"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>npm start</code> 启动开发，<code>npm run build</code> 编译出需要部署的文件。</p><h4 id="2-3引入js文件"><a href="#2-3引入js文件" class="headerlink" title="2.3引入js文件"></a>2.3引入js文件</h4><p>执行build之后会发现在build目录下生成一个了js，我们需要一个html来引入这个js。因此，执行下面的命令，安装插件：</p><p><code>npm install html-webpack-plugin --save-dev</code></p><p>安装完成之后，需要在项目根目录新建一个模板文件index.ejs，代码如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--width - 可视区域的宽度，值可为数字或关键词device-width --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--height - viewport的高度--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--initial-scale - 初始的缩放比例--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--minimum-scale - 允许用户缩放到的最小比例--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--maximum-scale - 允许用户缩放到的最大比例--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--user-scalable - 用户是否可以手动缩放--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span> = <span class="string">"viewport"</span> <span class="attr">content</span> = <span class="string">"width = device-width, initial-scale = 1.0, maximum-scale = 1.0, user-scalable = 0"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--content="telephone=yes" 在iPhone 手机上默认值是（电话号码显示为拨号的超链接）：--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--可将telephone=no，则手机号码不被显示为拨号链接--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使设备浏览网页时对数字不启用电话功能（不同设备解释不同，itouch点击数字为存入联系人，iphone为拨打电话），忽略将页面中的数字识别为电话号码。--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"format-detection"</span> <span class="attr">content</span>=<span class="string">"telephone=no"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--忽略识别邮箱--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"format-detection"</span> <span class="attr">content</span>=<span class="string">"email=no"</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--网站开启对 web app 程序的支持--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"apple-mobile-web-app-capable"</span> <span class="attr">content</span>=<span class="string">"yes"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--在 web app 应用下状态条（屏幕顶部条）的颜色；(改变顶部状态条的颜色)--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--默认值为 default（白色），可以定为 black（黑色）和 black-translucent（灰色半透明）；--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"apple-mobile-web-app-status-bar-style"</span> <span class="attr">content</span>=<span class="string">"black"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--http-equiv="Content-Type" 表示描述文档类型--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--HTTP-EQUIV类似于HTTP的头部协议，它回应给浏览器一些有用的信息，以帮助正确和精确地显示网页内容--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Type"</span> <span class="attr">content</span>=<span class="string">"text/html"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- UC默认竖屏 ，UC强制全屏 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"full-screen"</span> <span class="attr">content</span>=<span class="string">"yes"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--使用了application这种应用模式后，页面讲默认全屏，禁止长按菜单，禁止收拾，标准排版，以及强制图片显示。--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--应用模式--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"browsermode"</span> <span class="attr">content</span>=<span class="string">"application"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- QQ强制竖屏 QQ强制全屏 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--设置屏幕方向--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"x5-orientation"</span> <span class="attr">content</span>=<span class="string">"portrait"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--设置全屏--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"x5-fullscreen"</span> <span class="attr">content</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--设置屏幕模式--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"x5-page-mode"</span> <span class="attr">content</span>=<span class="string">"app"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- windows phone 点击无高光 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"msapplication-tap-highlight"</span> <span class="attr">content</span>=<span class="string">"no"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"app"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> <span class="attr">htmlWebpackPlugin.options.title</span> %&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;script src="http://localhost:8080/webpack-dev-server.js"&gt;&lt;/script&gt; --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;script src="bundle.js"&gt;&lt;/script&gt; --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>接下来，继续配置webpack，让这个模板生效。代码如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: [<span class="comment">// 'webpack/hot/dev-server',</span></span><br><span class="line">        <span class="comment">// 'webpack-dev-server/client?http://localhost:8080',</span></span><br><span class="line">        path.resolve(__dirname, <span class="string">'app.js'</span>)],</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'build'</span>),</span><br><span class="line">        <span class="comment">// publicPath: '/assets/', //表示资源的发布地址，当配置过该属性后，打包文件中所有通过相对路径引用的资源都会被配置的路径所替换。</span></span><br><span class="line">        filename: <span class="string">'bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(</span><br><span class="line">        &#123;</span><br><span class="line">            title: <span class="string">'测试'</span>,</span><br><span class="line">            template: <span class="string">'index.ejs'</span>,</span><br><span class="line">            <span class="comment">// favicon:'./src/img/favicon.ico',</span></span><br><span class="line">            minify: &#123;</span><br><span class="line">                <span class="comment">// removeAttributeQuotes: true,</span></span><br><span class="line">                <span class="comment">// collapseWhitespace: true,</span></span><br><span class="line">                removeComments:<span class="literal">true</span>,</span><br><span class="line">                preserveLineBreaks: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>现在可以再次执行 <code>npm start</code> ，执行完毕之后即可看到html页面了。这个html页面会引入webpack打包生成的js文件，执行 <code>npm run build</code> , 可以在项目的build目录下面看到所有编译出来的文件了。</p><h4 id="2-4安装babel支持ES6"><a href="#2-4安装babel支持ES6" class="headerlink" title="2.4安装babel支持ES6"></a>2.4安装babel支持ES6</h4><p>首先安装babel</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install babel-core babel-loader babel-plugin-transform-decorators-legacy babel-polyfill babel-preset-es2015 babel-preset-react babel-preset-stage-3 --save-dev</span><br></pre></td></tr></table></figure><p>以本机为例，安装下来之后的版本在package.json中查看：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="string">"babel-core"</span>: <span class="string">"^6.26.3"</span>,</span><br><span class="line"><span class="string">"babel-loader"</span>: <span class="string">"^7.0.0"</span>,</span><br><span class="line"><span class="string">"babel-plugin-transform-decorators-legacy"</span>: <span class="string">"^1.3.5"</span>,</span><br><span class="line"><span class="string">"babel-polyfill"</span>: <span class="string">"^6.26.0"</span>,</span><br><span class="line"><span class="string">"babel-preset-es2015"</span>: <span class="string">"^6.24.1"</span>,</span><br><span class="line"><span class="string">"babel-preset-react"</span>: <span class="string">"^6.24.1"</span>,</span><br><span class="line"><span class="string">"babel-preset-stage-3"</span>: <span class="string">"^6.24.1"</span>,</span><br></pre></td></tr></table></figure><p>配置方法：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> node_modules = path.resolve(__dirname, <span class="string">'node_modules'</span>);</span><br><span class="line"><span class="keyword">const</span> pathToReact = path.resolve(node_modules, <span class="string">'react/dist/react.min.js'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: [<span class="comment">// 'webpack/hot/dev-server',</span></span><br><span class="line">        <span class="comment">// 'webpack-dev-server/client?http://localhost:8080',</span></span><br><span class="line">        path.resolve(__dirname, <span class="string">'app.js'</span>)],</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'build'</span>),</span><br><span class="line">        <span class="comment">// publicPath: '/assets/', //表示资源的发布地址，当配置过该属性后，打包文件中所有通过相对路径引用的资源都会被配置的路径所替换。</span></span><br><span class="line">        filename: <span class="string">'bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(js|jsx)?$/</span>, <span class="comment">// 匹配'js' or 'jsx' 后缀的文件类型</span></span><br><span class="line">                exclude: <span class="regexp">/(node_modules|bower_components)/</span>, <span class="comment">// 排除某些文件</span></span><br><span class="line">                loader: <span class="string">'babel-loader'</span>, <span class="comment">// 使用'babel-loader'</span></span><br><span class="line">                query: &#123; <span class="comment">// 参数</span></span><br><span class="line">                    <span class="string">"presets"</span>: [<span class="string">"es2015"</span>, <span class="string">"react"</span>, <span class="string">"stage-3"</span>]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        noParse: [pathToReact]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(</span><br><span class="line">        &#123;</span><br><span class="line">            title: <span class="string">'测试'</span>,</span><br><span class="line">            template: <span class="string">'index.ejs'</span>,</span><br><span class="line">            <span class="comment">// favicon:'./src/img/favicon.ico',</span></span><br><span class="line">            minify: &#123;</span><br><span class="line">                <span class="comment">// removeAttributeQuotes: true,</span></span><br><span class="line">                <span class="comment">// collapseWhitespace: true,</span></span><br><span class="line">                removeComments:<span class="literal">true</span>,</span><br><span class="line">                preserveLineBreaks: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>接下来需要写一个页面来测试。</p><p>在src目录下新建一个App.jsx，写一个测试的页面：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            hello world！</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在根目录的app.js里面引入：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./src/App.jsx'</span>;</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span>, document.getElementById('app'));</span></span><br></pre></td></tr></table></figure><p>执行<code>npm start</code> 可以预览。</p><h4 id="2-5完成所有loader安装"><a href="#2-5完成所有loader安装" class="headerlink" title="2.5完成所有loader安装"></a>2.5完成所有loader安装</h4><p>首先先介绍以下常用loader：</p><ul><li>css-loader style-loader安装之后可以使用css文件</li><li>file-loader安装之后可以使用字体、多媒体等等文件</li><li>url-loader安装之后可以使用图片文件</li><li>less-loader安装之后可以使用less文件</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install css-loader style-loader file-loader less-loader url-loader less --save-dev</span><br></pre></td></tr></table></figure><p><strong>由于使用了less, css等，希望在编译时抽离出单独的css文件，也需要压缩css文件。需要安装 <code>extract-text-webpack-plugin</code> 插件</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install extract-text-webpack-plugin@2.1.2 --save-dev</span><br></pre></td></tr></table></figure><p>在webpack的配置文件：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> ExtractTextPlugin = <span class="built_in">require</span>(<span class="string">'extract-text-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> node_modules = path.resolve(__dirname, <span class="string">'node_modules'</span>);</span><br><span class="line"><span class="keyword">const</span> pathToReact = path.resolve(node_modules, <span class="string">'react/dist/react.min.js'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: [<span class="comment">// 'webpack/hot/dev-server',</span></span><br><span class="line">        <span class="comment">// 'webpack-dev-server/client?http://localhost:8080',</span></span><br><span class="line">        path.resolve(__dirname, <span class="string">'app.js'</span>)],</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'build'</span>),</span><br><span class="line">        <span class="comment">// publicPath: '/assets/', //表示资源的发布地址，当配置过该属性后，打包文件中所有通过相对路径引用的资源都会被配置的路径所替换。</span></span><br><span class="line">        filename: <span class="string">'bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(js|jsx)?$/</span>, <span class="comment">// 匹配'js' or 'jsx' 后缀的文件类型</span></span><br><span class="line">                exclude: <span class="regexp">/(node_modules|bower_components)/</span>, <span class="comment">// 排除某些文件</span></span><br><span class="line">                loader: <span class="string">'babel-loader'</span>, <span class="comment">// 使用'babel-loader'</span></span><br><span class="line">                query: &#123; <span class="comment">// 参数</span></span><br><span class="line">                    <span class="string">"presets"</span>: [<span class="string">"es2015"</span>, <span class="string">"react"</span>, <span class="string">"stage-3"</span>]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>, <span class="comment">// Only .css files</span></span><br><span class="line">                use: [<span class="string">'style-loader'</span>, <span class="string">'css-loader'</span>] <span class="comment">// Run both loaders 后者是为了遍历你的css。前者是为了进行style标记生成。</span></span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                test: <span class="regexp">/\.less$/</span>,</span><br><span class="line">                use: ExtractTextPlugin.extract(&#123;</span><br><span class="line">                    <span class="comment">// use:指需要什么样的loader去编译文件,这里由于源文件是.css所以选择css-loader</span></span><br><span class="line">                    <span class="comment">// fallback:编译后用什么loader来提取css文件</span></span><br><span class="line">                    <span class="comment">// publicfile:用来覆盖项目publicPath,生成该css文件的文件路径</span></span><br><span class="line">                    fallback: <span class="string">'style-loader'</span>,</span><br><span class="line">                    use: [<span class="string">'css-loader'</span>, <span class="string">'less-loader'</span>]</span><br><span class="line">                &#125;)</span><br><span class="line">                <span class="comment">//[</span></span><br><span class="line">                <span class="comment">// &#123;</span></span><br><span class="line">                <span class="comment">//   loader: "style-loader" // creates style nodes from JS strings</span></span><br><span class="line">                <span class="comment">// &#125;, &#123;</span></span><br><span class="line">                <span class="comment">//   loader: "css-loader" // translates CSS into CommonJS</span></span><br><span class="line">                <span class="comment">// &#125;, &#123;</span></span><br><span class="line">                <span class="comment">//   loader: "less-loader" // compiles Less to CSS</span></span><br><span class="line">                <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// "style-loader","css-loader","less-loader"</span></span><br><span class="line">                <span class="comment">//]</span></span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                test: <span class="regexp">/\.(png|jpg)$/</span>,</span><br><span class="line">                <span class="comment">// loader: 'url-loader?limit=1000&amp;name=images/[path][name].[ext]'</span></span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'url-loader'</span>,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            name: <span class="string">'[name].[ext]'</span>,</span><br><span class="line">                            <span class="comment">// publicPath: '',</span></span><br><span class="line">                            outputPath: <span class="string">'images/'</span>,</span><br><span class="line">                            limit: <span class="number">1000</span>,</span><br><span class="line">                        &#125;,</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                test: <span class="regexp">/\.(mp3|ttf|eot|svg|woff(2)?)(\?[a-z0-9=&amp;.]+)?$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'file-loader'</span>,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            name: <span class="string">'[name].[ext]'</span>,</span><br><span class="line">                            <span class="comment">// publicPath: '',</span></span><br><span class="line">                            outputPath: <span class="string">'assest/'</span>,</span><br><span class="line">                        &#125;,</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">                <span class="comment">// loader: 'file-loader'</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        noParse: [pathToReact]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(</span><br><span class="line">        &#123;</span><br><span class="line">            title: <span class="string">'测试'</span>,</span><br><span class="line">            template: <span class="string">'index.ejs'</span>,</span><br><span class="line">            <span class="comment">// favicon:'./src/img/favicon.ico',</span></span><br><span class="line">            minify: &#123;</span><br><span class="line">                <span class="comment">// removeAttributeQuotes: true,</span></span><br><span class="line">                <span class="comment">// collapseWhitespace: true,</span></span><br><span class="line">                removeComments:<span class="literal">true</span>,</span><br><span class="line">                preserveLineBreaks: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> ExtractTextPlugin(<span class="string">"styles.css"</span>)</span><br><span class="line">    ]</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="2-6加入Onsen-UI"><a href="#2-6加入Onsen-UI" class="headerlink" title="2.6加入Onsen UI"></a>2.6加入Onsen UI</h4><p>首先还是安装命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install onsenui react-onsenui --save</span><br></pre></td></tr></table></figure><p>在根目录的app.js引入这个UI库的样式，并且新建自己的样式表文件src/style/main.less：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./src/style/main.less'</span>; <span class="comment">// 自己写的样式的文件入口，在对应页面位置新建</span></span><br><span class="line"><span class="comment">// Webpack CSS import</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'onsenui/css/onsenui.css'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'onsenui/css/onsen-css-components.css'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./src/App.jsx'</span>;</span><br><span class="line">ReactDOM.render(<span class="xml"><span class="tag">&lt;<span class="name">App</span> /&gt;</span>, document.getElementById('app'));</span></span><br></pre></td></tr></table></figure><p>修改App.jsx查看UI库是否能够使用：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Page, Button &#125; <span class="keyword">from</span> <span class="string">'react-onsenui'</span>; <span class="comment">// 只引入需要的onsenui组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            &lt;Page&gt;<span class="xml"><span class="tag">&lt;<span class="name">Button</span>&gt;</span>Tap me!<span class="tag">&lt;/<span class="name">Button</span>&gt;</span></span></span><br><span class="line">            &lt;<span class="regexp">/Page&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p><code>npm start</code> 查看效果。</p><h3 id="3-开发阶段"><a href="#3-开发阶段" class="headerlink" title="3.开发阶段"></a>3.开发阶段</h3><h4 id="3-1安装react-router和local-db"><a href="#3-1安装react-router和local-db" class="headerlink" title="3.1安装react-router和local-db"></a>3.1安装react-router和local-db</h4><ul><li>react-router 使不同的访问地址映射到不同的页面逻辑</li><li>local-db 基于浏览器的localstorage来实现相对永久的储存</li></ul><p>首先还是执行命令安装react-router和local-db：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install react-router-dom local-db --save</span><br></pre></td></tr></table></figure><h4 id="3-2新建一个页面容器"><a href="#3-2新建一个页面容器" class="headerlink" title="3.2新建一个页面容器"></a>3.2新建一个页面容器</h4><p>下面将要演示一个页面容器的编写，关键点都有注释，新建一个页面，路径是container/PageContainer.jsx，为了兼顾使用之前添加进来的UI库，代码如下：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;withRouter&#125; <span class="keyword">from</span> <span class="string">"react-router-dom"</span>; <span class="comment">// 用这个方法来包裹组件，可以控制路由的跳转</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> LocalDB <span class="keyword">from</span> <span class="string">'local-db'</span>;</span><br><span class="line"><span class="keyword">const</span> userCollection = <span class="keyword">new</span> LocalDB(<span class="string">'user'</span>); <span class="comment">// 需要使用本地存储时，这里存储的是user</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; Page &#125; <span class="keyword">from</span> <span class="string">'react-onsenui'</span>; <span class="comment">// 使用onsenui的Page组件来做个每个页面的容器</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PageContainer</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 组件将要加载</span></span><br><span class="line">    componentWillMount() &#123;</span><br><span class="line">        <span class="keyword">const</span> user = userCollection.query(&#123;&#125;); <span class="comment">// 读取本地存储的内容</span></span><br><span class="line">        <span class="keyword">if</span> (user.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.props.history.replace(<span class="string">"/sign-in"</span>); <span class="comment">// 如果没有用户信息就跳转到登录页</span></span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'登录失效，退回登录页面'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 组件挂载完毕</span></span><br><span class="line">    componentDidMount() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">let</span> &#123; page &#125; = <span class="keyword">this</span>.props; <span class="comment">// 这里取到传递给这个容器的page属性</span></span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Page</span> <span class="attr">className</span>=<span class="string">"PageContainer"</span>&gt;</span>&#123;page?page:null&#125;<span class="tag">&lt;/<span class="name">Page</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> withRouter(PageContainer);</span><br></pre></td></tr></table></figure><p>现在新增一个登录页面：page/SignInPage.jsx，这个页面会引入上面新建的容器，并且把编写的页面放入容器之中。代码如下：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> PageContainer <span class="keyword">from</span> <span class="string">'../container/PageContainer.jsx'</span>; <span class="comment">// 引入页面的容器</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">SignInPage</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line"></span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    componentWillMount() &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 下面的代码将一个页面写出来，并且在return的时候，使用page属性传递给页面容器</span></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">const</span> page = (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"SignInPage"</span>&gt;</span></span></span><br><span class="line"><span class="xml">                        <span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"login-tab"</span>&gt;</span>导出容器包裹和包裹的页面<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">                    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">PageContainer</span> <span class="attr">page</span>=<span class="string">&#123;page&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    &#125;</span></span><br><span class="line"><span class="xml">&#125;;</span></span><br></pre></td></tr></table></figure><p>改造App.jsx，使用react-router来实现页面路由，可以参考注释，代码如下：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;HashRouter <span class="keyword">as</span> Router, Switch, Route, Link, Redirect&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 约定页面以**Page.jsx的方式命名，并且首字母大写，驼峰形式</span></span><br><span class="line"><span class="keyword">import</span> SignInPage <span class="keyword">from</span> <span class="string">'./page/SignInPage.jsx'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用path="/" 指定要匹配的路径 component指定路径对应的组件，下面就是指定了/sign-in为登录组件，为直接访问/路径会重定向到/sign-in</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></span><br><span class="line">            &lt;Switch&gt;</span><br><span class="line">                &lt;Route exact path="/" render=&#123;() =&gt; (&lt;Redirect to="/sign-in"/&gt;)&#125;/&gt;</span><br><span class="line">                &lt;Route exact path="/sign-in" component=&#123;SignInPage&#125;/&gt;</span><br><span class="line">            &lt;/Switch&gt;</span><br><span class="line">        &lt;/Router&gt;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-3现在来开始做一个登录页面"><a href="#3-3现在来开始做一个登录页面" class="headerlink" title="3.3现在来开始做一个登录页面"></a>3.3现在来开始做一个登录页面</h4><p>需要用的组件可以在链接里面找到：</p><ul><li><a href="https://onsen.io/v2/api/react/Page.html" target="_blank" rel="noopener">https://onsen.io/v2/api/react/Page.html</a></li><li><a href="https://onsen.io/theme-roller/" target="_blank" rel="noopener">https://onsen.io/theme-roller/</a></li></ul><p>在根路径新建一个util目录，并且新建一个Config.jsx，在这个文件里面放的是调用的接口服务器配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> CONFIG = &#123;</span><br><span class="line">    <span class="comment">//"apiUrl": "http://r1w9493829.51mypc.cn/rest-api"</span></span><br><span class="line">    <span class="string">"apiUrl"</span>: <span class="string">"http://192.168.100.12:8080/rest-api"</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>然后创建发送HTTP请求的service，在src目录新建一个service目录，并在里面新建一个HttpService.jsx，代码如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> LocalDB <span class="keyword">from</span> <span class="string">'local-db'</span>;</span><br><span class="line"><span class="keyword">const</span> userCollection = <span class="keyword">new</span> LocalDB(<span class="string">'user'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发送请求的service，主要创建了get和post两个请求的方法，分别创建XMLHttpRequest来发送请求，并且对请求的响应做处理。</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HttpService</span> </span>&#123;</span><br><span class="line">    Authorization: <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.getUserToekn();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    getUserToekn() &#123;</span><br><span class="line">        <span class="keyword">const</span> user = userCollection.query(&#123;&#125;);</span><br><span class="line">        <span class="keyword">if</span> (user.length) &#123;</span><br><span class="line">            <span class="keyword">this</span>.Authorization = user[<span class="number">0</span>].token;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    getQueryString(params) &#123;</span><br><span class="line">        <span class="keyword">let</span> query = [];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> params) &#123;</span><br><span class="line">            query.push(key + <span class="string">"="</span> + params[key]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> query.join(<span class="string">"&amp;"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    get(url, params) &#123;</span><br><span class="line">        <span class="keyword">this</span>.getUserToekn();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> request = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">            <span class="keyword">const</span> query = <span class="keyword">this</span>.getQueryString(params);</span><br><span class="line">            <span class="keyword">if</span> (query) &#123;</span><br><span class="line">                url += <span class="string">"?"</span> + query;</span><br><span class="line">            &#125;</span><br><span class="line">            request.open(<span class="string">"GET"</span>, url, <span class="literal">true</span>);</span><br><span class="line">            request.withCredentials = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.Authorization) &#123;</span><br><span class="line">                request.setRequestHeader(<span class="string">"Authorization"</span>, <span class="keyword">this</span>.Authorization);</span><br><span class="line">            &#125;</span><br><span class="line">            request.send();</span><br><span class="line">            request.onreadystatechange = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (request.readyState == <span class="number">4</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> status = request.status;</span><br><span class="line">                    <span class="keyword">if</span> (status &gt;= <span class="number">200</span> &amp;&amp; status &lt; <span class="number">300</span>) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            <span class="keyword">const</span> res = <span class="built_in">JSON</span>.parse(request.responseText);</span><br><span class="line">                            <span class="keyword">this</span>.Authorization = request.getResponseHeader(<span class="string">"Authorization"</span>);</span><br><span class="line">                            <span class="keyword">if</span>(<span class="keyword">this</span>.Authorization) &#123;</span><br><span class="line">                                userCollection.drop();</span><br><span class="line">                                userCollection.insert(&#123;</span><br><span class="line">                                    time: <span class="keyword">new</span> <span class="built_in">Date</span>().getTime(),</span><br><span class="line">                                    token: <span class="keyword">this</span>.Authorization</span><br><span class="line">                                &#125;);</span><br><span class="line">                            &#125;</span><br><span class="line">                            resolve(res);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                            <span class="built_in">console</span>.error(e);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (status == <span class="number">403</span>) &#123;</span><br><span class="line">                        <span class="built_in">window</span>.location.replace(<span class="string">"#/sign-in"</span>);</span><br><span class="line">                        userCollection.drop();</span><br><span class="line">                        reject()</span><br><span class="line">                        <span class="keyword">return</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (status == <span class="number">400</span>) &#123;</span><br><span class="line">                        <span class="built_in">console</span>.log();</span><br><span class="line">                        reject(error)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    post(url, params) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.getUserToekn();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">let</span> request = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">            request.onreadystatechange = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (request.readyState == <span class="number">4</span>) &#123;</span><br><span class="line">                    <span class="keyword">const</span> status = request.status;</span><br><span class="line">                    <span class="keyword">if</span> (status &gt;= <span class="number">200</span> &amp;&amp; status &lt; <span class="number">300</span>) &#123;</span><br><span class="line">                        <span class="keyword">const</span> res = <span class="built_in">JSON</span>.parse(request.responseText);</span><br><span class="line">                        <span class="keyword">this</span>.Authorization = request.getResponseHeader(<span class="string">"Authorization"</span>);</span><br><span class="line">                        <span class="keyword">if</span>(<span class="keyword">this</span>.Authorization) &#123;</span><br><span class="line">                            userCollection.drop();</span><br><span class="line">                            userCollection.insert(&#123;</span><br><span class="line">                                time: <span class="keyword">new</span> <span class="built_in">Date</span>().getTime(),</span><br><span class="line">                                token: <span class="keyword">this</span>.Authorization</span><br><span class="line">                            &#125;);</span><br><span class="line">                        &#125;</span><br><span class="line">                        resolve(res);</span><br><span class="line">                        <span class="keyword">return</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (status == <span class="number">403</span>) &#123;</span><br><span class="line">                        <span class="built_in">window</span>.location.replace(<span class="string">"#/sign-in"</span>);</span><br><span class="line">                        userCollection.drop();</span><br><span class="line">                        reject();</span><br><span class="line">                        <span class="keyword">return</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (status == <span class="number">400</span>) &#123;</span><br><span class="line">                        reject();</span><br><span class="line">                        <span class="built_in">console</span>.log(error);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            request.open(<span class="string">"POST"</span>, url, <span class="literal">true</span>);</span><br><span class="line">            <span class="comment">//request.withCredentials = true;</span></span><br><span class="line">            request.setRequestHeader(<span class="string">"Content-Type"</span>, <span class="string">"application/json"</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.Authorization) &#123;</span><br><span class="line">                request.setRequestHeader(<span class="string">"Authorization"</span>, <span class="keyword">this</span>.Authorization);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            request.send(<span class="built_in">JSON</span>.stringify(params));</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> HTTP = <span class="keyword">new</span> HttpService();</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> HTTP</span><br></pre></td></tr></table></figure><p>再新建一个UserService.jsx文件，里面的代码如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> HttpService <span class="keyword">from</span> <span class="string">'./HttpService.jsx'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;CONFIG&#125; <span class="keyword">from</span> <span class="string">'../util/Config.jsx'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;&#125;</span><br><span class="line">    <span class="comment">// 登录</span></span><br><span class="line">    signIn(params) &#123;</span><br><span class="line">        <span class="keyword">return</span> HttpService.post(<span class="string">`<span class="subst">$&#123;CONFIG.apiUrl&#125;</span>/account/login.html`</span>, params);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查询列表</span></span><br><span class="line">    findExhibitionList(params) &#123;</span><br><span class="line">        <span class="keyword">return</span> HttpService.post(<span class="string">`<span class="subst">$&#123;CONFIG.apiUrl&#125;</span>/account/findExhibitionList.html`</span>, params);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> User = <span class="keyword">new</span> UserService();</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> User;</span><br></pre></td></tr></table></figure><p>接着来修改登录页面，实现登录功能，page/SignInPage.jsx代码如下</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> PageContainer <span class="keyword">from</span> <span class="string">'../container/PageContainer.jsx'</span>; <span class="comment">// 引入页面的容器</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; Button, Segment &#125; <span class="keyword">from</span> <span class="string">'react-onsenui'</span>; <span class="comment">// 引入UI库的Button组件</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> UserService <span class="keyword">from</span> <span class="string">'../service/UserService.jsx'</span>; <span class="comment">// 引入service</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">SignInPage</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">this</span>.state = &#123; <span class="comment">// 只要这个对象里面的属性变了，页面就会渲染更新 使用this.setState可以改变这里面的值</span></span><br><span class="line">            tel: <span class="string">''</span>,</span><br><span class="line">            password: <span class="string">''</span>,</span><br><span class="line">            loginName: <span class="string">''</span>,</span><br><span class="line">            smsCode: <span class="string">''</span>,</span><br><span class="line">            loginType: <span class="number">1</span> <span class="comment">// 1手机号验证码 2账号密码</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">this</span>.changeType = <span class="keyword">this</span>.changeType.bind(<span class="keyword">this</span>); <span class="comment">// 绑定上下文，好让changeType里面可以使用this,比如使用this.setState</span></span><br><span class="line">        <span class="keyword">this</span>.doSignIn = <span class="keyword">this</span>.doSignIn.bind(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    componentWillMount() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    changeType(type) &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            loginType: type</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    doSignIn() &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; loginName, password &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">        UserService.signIn(&#123; loginName, password &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(res &amp;&amp; res.success) &#123;</span><br><span class="line">                alert(<span class="string">'成功'</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                alert(res.message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">            alert(<span class="string">'请求失败'</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; loginType &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">        <span class="keyword">const</span> page = (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"SignInPage"</span>&gt;</span></span></span><br><span class="line">            &lt;Segment&gt;</span><br><span class="line">                &lt;button onClick=&#123;() =&gt; &#123;this.changeType(1)&#125;&#125;&gt;手机登录&lt;/button&gt;</span><br><span class="line">                &lt;button onClick=&#123;() =&gt; &#123;this.changeType(2)&#125;&#125;&gt;账号登录&lt;/button&gt;</span><br><span class="line"><span class="xml">            <span class="tag">&lt;/<span class="name">Segment</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;</span></span><br><span class="line">                loginType == 1 ?&lt;div&gt;</span><br><span class="line">                    &lt;input onChange=&#123;event =&gt; this.setState(&#123;tel: event.target.value&#125;)&#125; placeholder="输入手机号" type="tel" /&gt;</span><br><span class="line">                    &lt;input onChange=&#123;event =&gt; this.setState(&#123;smsCode: event.target.value&#125;)&#125; placeholder="输入验证码" type="password" /&gt;</span><br><span class="line">                    &lt;div&gt;验证码&lt;/div&gt;</span><br><span class="line">                &lt;/div&gt;:</span><br><span class="line">                    &lt;div&gt;</span><br><span class="line">                        &lt;input onChange=&#123;event =&gt; this.setState(&#123;loginName: event.target.value&#125;)&#125; placeholder="输入账号" type="text" /&gt;</span><br><span class="line">                        &lt;input onChange=&#123;event =&gt; this.setState(&#123;password: event.target.value&#125;)&#125; placeholder="输入密码" type="password" /&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">            &#125;</span><br><span class="line">            &lt;Button modifier="large--cta" onClick=&#123;this.doSignIn&#125;&gt;</span><br><span class="line">                登录</span><br><span class="line">            &lt;/Button&gt;</span><br><span class="line">        &lt;/div&gt;);</span><br><span class="line">        return &lt;PageContainer page=&#123;page&#125; /&gt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>现在可以尝试登录了。</p><h4 id="3-4样式编写"><a href="#3-4样式编写" class="headerlink" title="3.4样式编写"></a>3.4样式编写</h4><p>在src/style/main.less文件中引入需要的样式：</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// util</span></span><br><span class="line"><span class="keyword">@import</span> <span class="string">"./util/Variable.less"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// pages</span></span><br><span class="line"><span class="keyword">@import</span> <span class="string">"./page/SignInPage.less"</span>;</span><br></pre></td></tr></table></figure><p>建立对应的文件，如下;</p><p>src/style/util/Variable.less</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="variable">@color-common:</span> <span class="number">#52a7f1</span>; <span class="comment">// 通常颜色</span></span><br><span class="line"><span class="variable">@color-secondary:</span> <span class="number">#CCC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主题颜色</span></span><br><span class="line"><span class="comment">// @color-title-bg:       #CDB284;</span></span><br><span class="line"><span class="variable">@color-title-bg:</span>       <span class="number">#66B3FF</span>;</span><br><span class="line"><span class="variable">@color-text-bg:</span>        <span class="number">#EFF1E1</span>;</span><br><span class="line"><span class="variable">@color-normal-bg:</span>      <span class="number">#EDF5F2</span>;</span><br><span class="line"><span class="variable">@color-line:</span>           <span class="number">#DCE3EC</span>;</span><br><span class="line"><span class="variable">@color-dark-line:</span>      <span class="number">#947361</span>;</span><br><span class="line"><span class="variable">@color-shadow:</span>         <span class="number">#D3CEDD</span>;</span><br><span class="line"><span class="variable">@color-element:</span>        <span class="number">#CD939D</span>;</span><br><span class="line"><span class="variable">@color-text-dark:</span>      <span class="number">#7b2e55</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// icon颜色</span></span><br><span class="line"><span class="variable">@color-green:</span>          <span class="number">#4fc195</span>;</span><br><span class="line"><span class="variable">@color-green-dark:</span>     <span class="number">#207245</span>;</span><br><span class="line"><span class="variable">@color-red:</span>            <span class="number">#ff2e2e</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">@color-title-text:</span>     <span class="number">#FFFFFF</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">@color-white:</span> <span class="number">#ffffff</span>; <span class="comment">// 按钮背景纯白色</span></span><br><span class="line"><span class="variable">@color-light:</span> <span class="number">#f7f7f7</span>; <span class="comment">// 背景淡灰色</span></span><br><span class="line"><span class="variable">@color-gray:</span> <span class="number">#dedede</span>; <span class="comment">// 边框浅灰色</span></span><br><span class="line"><span class="variable">@color-dark:</span> <span class="number">#989898</span>; <span class="comment">// 文字浅灰色</span></span><br><span class="line"><span class="variable">@color-darker:</span> <span class="number">#656565</span>; <span class="comment">// 文字深灰色</span></span><br><span class="line"><span class="variable">@color-darkest:</span> <span class="number">#282828</span>; <span class="comment">// 文字黑色</span></span><br><span class="line"><span class="variable">@color-black:</span> <span class="number">#000000</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">@font-mini:</span> <span class="number">1rem</span>;</span><br><span class="line"><span class="variable">@font-smaller:</span> <span class="number">1.2rem</span>;</span><br><span class="line"><span class="variable">@font-small:</span> <span class="number">1.3rem</span>;</span><br><span class="line"><span class="variable">@font-normal:</span> <span class="number">1.4rem</span>;</span><br><span class="line"><span class="variable">@font-big:</span> <span class="number">1.5rem</span>;</span><br><span class="line"><span class="variable">@font-bigger:</span> <span class="number">1.6rem</span>;</span><br><span class="line"><span class="variable">@font-large:</span> <span class="number">1.7rem</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">@images:</span> <span class="string">"../../assest/images"</span>;</span><br></pre></td></tr></table></figure><p>src/style/util/SignInPage.less</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.SignInPage</span> &#123;</span><br><span class="line">  <span class="selector-class">.input-filed</span> &#123;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">2.4rem</span>;</span><br><span class="line">    <span class="attribute">border</span>: none;</span><br><span class="line">    <span class="attribute">padding</span>: .<span class="number">2rem</span> <span class="number">1rem</span>;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">border-bottom</span>: solid <span class="number">0.1rem</span> <span class="variable">@color-line</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.input-container</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: flex;</span><br><span class="line">    <span class="attribute">display</span>: -webkit-flex;</span><br><span class="line">    <span class="selector-class">.input-filed</span> &#123;</span><br><span class="line">      <span class="attribute">flex</span>: <span class="number">1</span>;</span><br><span class="line">      <span class="attribute">-webkit-flex</span>: <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.input-ft</span> &#123;</span><br><span class="line">      <span class="attribute">line-height</span>: <span class="number">2.4rem</span>;</span><br><span class="line">      <span class="attribute">border</span>: none;</span><br><span class="line">      <span class="attribute">padding</span>: .<span class="number">2rem</span> <span class="number">1rem</span>;</span><br><span class="line">      <span class="attribute">background</span>: <span class="variable">@color-red</span>;</span><br><span class="line">      <span class="attribute">color</span>: <span class="variable">@color-white</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="selector-class">.sign-in-form</span> &#123;</span><br><span class="line">    <span class="attribute">padding-top</span>: <span class="number">8rem</span>;</span><br><span class="line">    <span class="attribute">text-align</span>: center;</span><br><span class="line">    <span class="selector-class">.input-box</span> &#123;</span><br><span class="line">      <span class="attribute">margin-bottom</span>: <span class="number">1rem</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="selector-class">.segment</span> &#123;</span><br><span class="line">      <span class="attribute">margin-bottom</span>: <span class="number">1rem</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>我们可以启动页面查看对应的样式效果了。</p><h4 id="3-5MD5加密"><a href="#3-5MD5加密" class="headerlink" title="3.5MD5加密"></a>3.5MD5加密</h4><p>使用crypto-js来对密码进行md5加密传输，首先安装crypto-js：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install crypto-js -save</span><br></pre></td></tr></table></figure><p>然后在登录页引用，修改登录页代码：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> PageContainer <span class="keyword">from</span> <span class="string">'../container/PageContainer.jsx'</span>; <span class="comment">// 引入页面的容器</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> MD5 <span class="keyword">from</span> <span class="string">"crypto-js/md5"</span>; <span class="comment">// 引入md5加密</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; Button, Segment &#125; <span class="keyword">from</span> <span class="string">'react-onsenui'</span>; <span class="comment">// 引入UI库的Button组件</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> UserService <span class="keyword">from</span> <span class="string">'../service/UserService.jsx'</span>; <span class="comment">// 引入service</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">SignInPage</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">this</span>.state = &#123; <span class="comment">// 只要这个对象里面的属性变了，页面就会渲染更新 使用this.setState可以改变这里面的值</span></span><br><span class="line">            tel: <span class="string">''</span>,</span><br><span class="line">            password: <span class="string">''</span>,</span><br><span class="line">            loginName: <span class="string">''</span>,</span><br><span class="line">            smsCode: <span class="string">''</span>,</span><br><span class="line">            loginType: <span class="number">1</span> <span class="comment">// 1手机号验证码 2账号密码</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">this</span>.changeType = <span class="keyword">this</span>.changeType.bind(<span class="keyword">this</span>); <span class="comment">// 绑定上下文，好让changeType里面可以使用this,比如使用this.setState</span></span><br><span class="line">        <span class="keyword">this</span>.doSignIn = <span class="keyword">this</span>.doSignIn.bind(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    componentWillMount() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    changeType(type) &#123;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            loginType: type</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    doSignIn() &#123;</span><br><span class="line">        <span class="keyword">let</span> &#123; loginName, password &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">        password = MD5(password).toString(); <span class="comment">// md5加密</span></span><br><span class="line">        UserService.signIn(&#123; loginName, password &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(res &amp;&amp; res.success) &#123;</span><br><span class="line">                <span class="keyword">this</span>.props.history.replace(<span class="string">"/exhibition"</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                alert(res.message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">            alert(<span class="string">'请求失败'</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; loginType &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">        <span class="keyword">const</span> page = (<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"SignInPage"</span>&gt;</span></span></span><br><span class="line">            &lt;div className="sign-in-form"&gt;</span><br><span class="line">                &lt;Segment&gt;</span><br><span class="line">                    &lt;button onClick=&#123;() =&gt; &#123;this.changeType(1)&#125;&#125;&gt;手机登录&lt;/button&gt;</span><br><span class="line">                    &lt;button onClick=&#123;() =&gt; &#123;this.changeType(2)&#125;&#125;&gt;账号登录&lt;/button&gt;</span><br><span class="line">                &lt;/Segment&gt;</span><br><span class="line">                &#123;</span><br><span class="line">                    loginType == 1</span><br><span class="line">                        ?&lt;div className="input-box"&gt;</span><br><span class="line">                            &lt;div className="input-container"&gt;</span><br><span class="line">                                &lt;input className="input-filed" onChange=&#123;event =&gt; this.setState(&#123;tel: event.target.value&#125;)&#125; placeholder="输入手机号" type="tel" /&gt;</span><br><span class="line">                                &lt;div  className="input-ft"&gt;验证码&lt;/div&gt;</span><br><span class="line">                            &lt;/div&gt;</span><br><span class="line">                            &lt;div className="input-container"&gt;</span><br><span class="line">                                &lt;input className="input-filed" onChange=&#123;event =&gt; this.setState(&#123;smsCode: event.target.value&#125;)&#125; placeholder="输入验证码" type="password" /&gt;</span><br><span class="line">                            &lt;/div&gt;</span><br><span class="line">                        &lt;/div&gt;:</span><br><span class="line">                        &lt;div className="input-box"&gt;</span><br><span class="line">                            &lt;div className="input-container"&gt;</span><br><span class="line">                                &lt;input className="input-filed" onChange=&#123;event =&gt; this.setState(&#123;loginName: event.target.value&#125;)&#125; placeholder="输入账号" type="text" /&gt;</span><br><span class="line">                            &lt;/div&gt;</span><br><span class="line">                            &lt;div className="input-container"&gt;</span><br><span class="line">                                &lt;input className="input-filed" onChange=&#123;event =&gt; this.setState(&#123;password: event.target.value&#125;)&#125; placeholder="输入密码" type="password" /&gt;</span><br><span class="line">                            &lt;/div&gt;</span><br><span class="line">                        &lt;/div&gt;</span><br><span class="line">                &#125;</span><br><span class="line">                &lt;Button modifier="large--cta" onClick=&#123;this.doSignIn&#125;&gt;</span><br><span class="line">                    登录</span><br><span class="line">                &lt;/Button&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;);</span><br><span class="line">        return &lt;PageContainer page=&#123;page&#125; noBack=&#123;true&#125; noHeader=&#123;true&#125; /&gt;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="3-6页面跳转和页面逻辑处理实例"><a href="#3-6页面跳转和页面逻辑处理实例" class="headerlink" title="3.6页面跳转和页面逻辑处理实例"></a>3.6页面跳转和页面逻辑处理实例</h4><p>我们发现上面的登录页面使用了<code>this.props.history.replace(&quot;/exhibition&quot;);</code> 目的是为了在登录成功之后跳转到一个新的页面。</p><p>现在来看这个页面的实现，新建一个页面 page/ExhibitionPage.jsx 来实现一个列表的加载，代码如下：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> PageContainer <span class="keyword">from</span> <span class="string">'../container/PageContainer.jsx'</span>; <span class="comment">// 引入页面的容器</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> UserService <span class="keyword">from</span> <span class="string">'../service/UserService.jsx'</span>; <span class="comment">// 引入service</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">ExhibitionPage</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(props) &#123;</span><br><span class="line">        <span class="keyword">super</span>(props);</span><br><span class="line">        <span class="keyword">this</span>.state = &#123;</span><br><span class="line">            list: [],</span><br><span class="line">            seasons: [<span class="string">'春'</span>, <span class="string">'秋'</span>],</span><br><span class="line">            page: <span class="number">1</span>,</span><br><span class="line">            rows: <span class="number">2</span>,</span><br><span class="line">            hasMore: <span class="literal">false</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">this</span>.getData = <span class="keyword">this</span>.getData.bind(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">this</span>.getMore = <span class="keyword">this</span>.getMore.bind(<span class="keyword">this</span>);</span><br><span class="line">        <span class="keyword">this</span>.refresh = <span class="keyword">this</span>.refresh.bind(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 组件将要加载</span></span><br><span class="line">    componentWillMount() &#123;</span><br><span class="line">        <span class="keyword">this</span>.getData();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    getData() &#123;</span><br><span class="line">        <span class="keyword">let</span> &#123; page, rows, list, hasMore&#125; = <span class="keyword">this</span>.state;</span><br><span class="line">        <span class="comment">//let a = &#123;</span></span><br><span class="line">        <span class="comment">//    "ada":12313</span></span><br><span class="line">        <span class="comment">//&#125;;</span></span><br><span class="line">        <span class="comment">//let b = &#123;</span></span><br><span class="line">        <span class="comment">//    page, rows</span></span><br><span class="line">        <span class="comment">//&#125;</span></span><br><span class="line">        <span class="comment">//let c = &#123;</span></span><br><span class="line">        <span class="comment">//    ...a, ...b</span></span><br><span class="line">        <span class="comment">//&#125;</span></span><br><span class="line">        <span class="comment">//console.log(c)</span></span><br><span class="line">        UserService.findExhibitionList(&#123;</span><br><span class="line">            page,</span><br><span class="line">            rows</span><br><span class="line">        &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(res &amp;&amp; res.success) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(res.entity);</span><br><span class="line">                <span class="keyword">if</span>(res.entity &amp;&amp; res.entity.items) &#123;</span><br><span class="line">                    hasMore = res.entity.hasNextPage;</span><br><span class="line">                    <span class="keyword">if</span>(page &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                        list = list.concat(res.entity.items) ;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        list = res.entity.items;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">                        list, hasMore</span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                alert(res.message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">            alert(<span class="string">'请求失败'</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    getMore() &#123;</span><br><span class="line">        <span class="keyword">let</span> &#123; page &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">        page ++;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            page</span><br><span class="line">        &#125;, () =&gt; &#123;</span><br><span class="line">            <span class="keyword">this</span>.getData();</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    refresh() &#123;</span><br><span class="line">        <span class="keyword">let</span> &#123; page &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">        page = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">this</span>.setState(&#123;</span><br><span class="line">            page</span><br><span class="line">        &#125;, () =&gt; &#123;</span><br><span class="line">            <span class="keyword">this</span>.getData();</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 组件挂载完毕</span></span><br><span class="line">    componentDidMount() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">let</span> &#123; list, seasons, hasMore &#125; = <span class="keyword">this</span>.state;</span><br><span class="line">        <span class="keyword">const</span> page = <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">"ExhibitionPage"</span>&gt;</span></span></span><br><span class="line"><span class="xml">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;this.refresh&#125;</span> &gt;</span>刷新<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">            &#123;</span></span><br><span class="line">                list.map((item, i) =&gt; &lt;div key=&#123;item.id&#125;&gt;</span><br><span class="line">                    &lt;div&gt;&#123;item.name&#125;&lt;/div&gt;</span><br><span class="line">                    &lt;div&gt;&#123;seasons[item.season - 1]&#125;&lt;/div&gt;</span><br><span class="line"><span class="xml">                <span class="tag">&lt;/<span class="name">div</span>&gt;</span>)</span></span><br><span class="line"><span class="xml">            &#125;</span></span><br><span class="line"><span class="xml">            &#123;hasMore?<span class="tag">&lt;<span class="name">div</span> <span class="attr">onClick</span>=<span class="string">&#123;this.getMore&#125;</span> &gt;</span>加载更多<span class="tag">&lt;/<span class="name">div</span>&gt;</span>:<span class="tag">&lt;<span class="name">div</span>&gt;</span>没有更多了<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">PageContainer</span> <span class="attr">page</span>=<span class="string">&#123;page&#125;</span>  <span class="attr">noBack</span>=<span class="string">&#123;true&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    &#125;</span></span><br><span class="line"><span class="xml">&#125;</span></span><br></pre></td></tr></table></figure><p>页面新建好了之后，需要在路由里面引入，所以修改App.jsx：</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123;HashRouter <span class="keyword">as</span> Router, Switch, Route, Link, Redirect&#125; <span class="keyword">from</span> <span class="string">'react-router-dom'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 约定页面以**Page.jsx的方式命名，并且首字母大写，驼峰形式</span></span><br><span class="line"><span class="keyword">import</span> SignInPage <span class="keyword">from</span> <span class="string">'./page/SignInPage.jsx'</span>;</span><br><span class="line"><span class="keyword">import</span> ExhibitionPage <span class="keyword">from</span> <span class="string">'./page/ExhibitionPage.jsx'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">    render() &#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="xml"><span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></span><br><span class="line">            &lt;Switch&gt;</span><br><span class="line">                &lt;Route exact path="/" render=&#123;() =&gt; (&lt;Redirect to="/exhibition"/&gt;)&#125;/&gt;</span><br><span class="line">                &lt;Route exact path="/sign-in" component=&#123;SignInPage&#125;/&gt;</span><br><span class="line">                &lt;Route exact path="/exhibition" component=&#123;ExhibitionPage&#125;/&gt;</span><br><span class="line">            &lt;/Switch&gt;</span><br><span class="line">        &lt;/Router&gt;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><footer class="article-footer"><a data-url="http://blog.moyufed.com/2018/12/10/React+Webpack+OnsenUI搭建前端项目/" data-id="ck8k1iwn1000wz4vy1m04za10" class="article-share-link">Share</a><ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OnsenUI/">OnsenUI</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/">React</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Webpack/">Webpack</a></li></ul></footer></div><nav id="article-nav"><a href="/2019/01/06/react-intl + React Context API 实现多语言切换/" id="article-nav-newer" class="article-nav-link-wrap"><strong class="article-nav-caption">Newer</strong><div class="article-nav-title">react-intl + React Context API 实现多语言切换</div></a><a href="/2018/10/12/CentOS 7安装和配置wcp知识库系统/" id="article-nav-older" class="article-nav-link-wrap"><strong class="article-nav-caption">Older</strong><div class="article-nav-title">CentOS 7安装和配置wcp知识库系统</div></a></nav></article></section><aside id="sidebar"><div class="widget-wrap"><h3 class="widget-title">标签</h3><div class="widget"><ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/">Nginx</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OnsenUI/">OnsenUI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/">React</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Wcp/">Wcp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Webpack/">Webpack</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nodejs/">nodejs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/">react</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react-intl/">react-intl</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react-redux/">react-redux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/redux/">redux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/前端/">前端</a></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">标签云</h3><div class="widget tagcloud"><a href="/tags/Linux/" style="font-size:20px">Linux</a> <a href="/tags/Nginx/" style="font-size:10px">Nginx</a> <a href="/tags/OnsenUI/" style="font-size:10px">OnsenUI</a> <a href="/tags/React/" style="font-size:20px">React</a> <a href="/tags/Wcp/" style="font-size:10px">Wcp</a> <a href="/tags/Webpack/" style="font-size:10px">Webpack</a> <a href="/tags/mongodb/" style="font-size:20px">mongodb</a> <a href="/tags/nodejs/" style="font-size:10px">nodejs</a> <a href="/tags/react/" style="font-size:10px">react</a> <a href="/tags/react-intl/" style="font-size:10px">react-intl</a> <a href="/tags/react-redux/" style="font-size:10px">react-redux</a> <a href="/tags/redux/" style="font-size:10px">redux</a> <a href="/tags/前端/" style="font-size:10px">前端</a></div></div><div class="widget-wrap"><h3 class="widget-title">归档</h3><div class="widget"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li></ul></div></div><div class="widget-wrap"><h3 class="widget-title">最新文章</h3><div class="widget"><ul><li><a href="/2020/04/04/【前端开发日常-18】快速配置webpack开发环境/">【前端开发日常 - 18】快速配置webpack开发环境</a></li><li><a href="/2020/03/31/JavaScript的this关键字/">JavaScript的this关键字</a></li><li><a href="/2020/03/31/File-APIs（Blob-BlobURL-ArrayBuffer-FileReader）/">File APIs（Blob, BlobURL, ArrayBuffer, FileReader）</a></li><li><a href="/2019/12/17/使用Taro开发一个微信小程序一/">使用Taro开发一个微信小程序一</a></li><li><a href="/2019/11/24/个人账单和砸金蛋前端动画分享/">个人账单和砸金蛋前端动画分享</a></li></ul></div></div></aside></div><footer id="footer"><div class="outer"><div id="footer-info" class="inner">&copy; 2020 Moyufed<br>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a><br><a href="http://www.beian.miit.gov.cn" target="_blank">黔ICP备18007258号</a></div></div></footer></div><nav id="mobile-nav"><a href="/" class="mobile-nav-link">Home</a> <a href="/archives" class="mobile-nav-link">Archives</a></nav><script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script><link rel="stylesheet" href="/fancybox/jquery.fancybox.css"><script src="/fancybox/jquery.fancybox.pack.js"></script><script src="/js/script.js"></script></div></body>